<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Deploying OpenStack with KVM and VMware NSX - Part 2: Configure NSX Transport and Logical network views &#8211; Juanma's Blog</title>
<meta name="description" content="Welcome to Part 2 of this series about OpenStack and NSX. In the first
part
we defined the basic NSX concepts and components, installed and
configured the NSX appliances and connected the NSX Controller Cluster
with the NSX Manager. In this second part we will see how Transport and
Logical networks are configured, get yourself comfortable because this
is going to be a long post :-)

">
<meta name="keywords" content="Cloud, network virtualization, networking, NSX, NSX-MH, Open vSwitch, OpenFlow, OpenStack, OVS, VMware">

  

<!-- Twitter Cards -->
<meta name="twitter:title" content="Deploying OpenStack with KVM and VMware NSX - Part 2: Configure NSX Transport and Logical network views">
<meta name="twitter:description" content="Welcome to Part 2 of this series about OpenStack and NSX. In the first
part
we defined the basic NSX concepts and components, installed and
configured the NSX appliances and connected the NSX Controller Cluster
with the NSX Manager. In this second part we will see how Transport and
Logical networks are configured, get yourself comfortable because this
is going to be a long post :-)

">
<meta name="twitter:site" content="@jreypo">


<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Deploying OpenStack with KVM and VMware NSX - Part 2: Configure NSX Transport and Logical network views">
<meta property="og:description" content="Welcome to Part 2 of this series about OpenStack and NSX. In the first
part
we defined the basic NSX concepts and components, installed and
configured the NSX appliances and connected the NSX Controller Cluster
with the NSX Manager. In this second part we will see how Transport and
Logical networks are configured, get yourself comfortable because this
is going to be a long post :-)

">
<meta property="og:url" content="/cloud/linux/networking/openstack/vmware/deploying-openstack-with-kvm-and-vmware-nsx-part-2-configure-nsx-transport-and-logical-network-views/">
<meta property="og:site_name" content="Juanma's Blog">

<meta property="og:image" content="/images/default-thumb.png">






<link rel="canonical" href="/cloud/linux/networking/openstack/vmware/deploying-openstack-with-kvm-and-vmware-nsx-part-2-configure-nsx-transport-and-logical-network-views/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Juanma's Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/">Juanma's Blog</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="/about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="/posts/" >Posts</a></li>
				
				    
				        
				    
				    <li><a href="/vmware-hp-links/" >HP Resources for VMware</a></li>
				
				    
				        
				    
				    <li><a href="/tags/" >Tags</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    
  

<div itemscope itemtype="http://schema.org/Person">


	<img src="/images/" class="bio-photo" alt=" bio photo">


  <h3 itemprop="name"></h3>
  <p></p>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="/cloud/linux/networking/openstack/vmware/deploying-openstack-with-kvm-and-vmware-nsx-part-2-configure-nsx-transport-and-logical-network-views/" rel="bookmark" title="Deploying OpenStack with KVM and VMware NSX - Part 2: Configure NSX Transport and Logical network views">Deploying OpenStack with KVM and VMware NSX - Part 2: Configure NSX Transport and Logical network views</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>Welcome to Part 2 of this series about OpenStack and NSX. In the <a href="http://jreypo.wordpress.com/2014/04/29/deploying-openstack-with-kvm-and-vmware-nsx-part-1-nsx-overview-and-initial-setup/" title="Deploying OpenStack with KVM and VMware NSX â€“ Part 1: NSX overview and initial setup">first
part</a>
we defined the basic NSX concepts and components, installed and
configured the NSX appliances and connected the NSX Controller Cluster
with the NSX Manager. In this second part we will see how Transport and
Logical networks are configured, get yourself comfortable because this
is going to be a long post :-)</p>

<p>To quickly refresh our concepts remember that the logical network
represents the virtual machine point of view of the network and the
transport network represents the underlying physical network through its
transport nodes.</p>

<h3 id="configure-the-transport-network">Configure the Transport Network</h3>

<p>The first step to have a fully functional NSX infrastructure is to
configure the <strong>Transport Network</strong>. The Transport Network is made of
the Transport Zone and the Transport Nodes. These transport nodes can be
NSX appliances like Service Nodes or Gateways and hypervisors like KVM
or ESXi hosts. Third-party hardware L2 Gateways can also be transport
nodes but those are out of the scope of this series.</p>

<h4 id="create-a-transport-zone">Create a Transport Zone</h4>

<p>A Transport Zone is a representation of the physical network used to to
send traffic between OVS instances. Without a transport zone the
transport nodes cannot be connected to NSX so it is mandatory that you
define it before performing any operation on them.</p>

<p>Select <em>Network Components</em> &gt; <em>Transport Layer</em> &gt; <em>Transport
Zones</em>.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/04/screen-shot-2014-04-28-at-22-30-40.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-04-28-at-22-30-40.png" alt="Screen Shot 2014-04-28 at
22.30.40" /></a></p>

<p>In the next screen click <em>Add</em> to launch the <em>Create Transport Zone</em>
wizard. This same wizard can also be launched from the Dashboard screen
in the <em>Summary of Transport Components</em> area click the <em>Add</em> button
form the <em>Zones</em> row.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/04/screen-shot-2014-04-28-at-22-36-05.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-04-28-at-22-36-05.png" alt="Screen Shot 2014-04-28 at
22.36.05" /></a></p>

<p>Enter the name of the Transport Zone and click <em>Save &amp; View</em>.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/04/screen-shot-2014-04-28-at-22-41-43.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-04-28-at-22-41-43.png?w=300" alt="Screen Shot 2014-04-28 at
22.41.43" /></a></p>

<p>The new transport zone will now be available.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/04/screen-shot-2014-04-29-at-00-11-59.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-04-29-at-00-11-59.png?w=580" alt="Screen Shot 2014-04-29 at
00.11.59" /></a></p>

<p>With the Transport Zone created we can start configuring the transport
nodes.</p>

<h4 id="configure-the-transport-nodes">Configure the Transport Nodes</h4>

<p>As we detailed in Part 1 the Service Node appliances are installed and
configured independently as the rest of the appliances however they need
to be added to NSX Controller Cluster in order to be able to perform the
offloading function for the OVS devices.</p>

<p>From the <em>Summary of Transport Components</em> section in the Dashboard
screen click <em>Add</em>.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/04/screen-shot-2014-04-29-at-00-29-14.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-04-29-at-00-29-14.png" alt="Screen Shot 2014-04-29 at
00.29.14" /></a></p>

<p>The <em>Create Service Node</em> window will show up. In the first screen
select <em>Service Node</em> as the <em>Transport Node Type</em> and click <em>Next</em>.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/04/screen-shot-2014-04-29-at-00-31-59.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-04-29-at-00-31-59.png?w=580" alt="Screen Shot 2014-04-29 at
00.31.59" /></a></p>

<p>Enter the display name for the Service Node, in this case <em>nsxsn</em>.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/04/screen-shot-2014-04-29-at-00-39-15.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-04-29-at-00-39-15.png?w=580" alt="Screen Shot 2014-04-29 at
00.39.15" /></a></p>

<p>In the Properties screen you will see three settings available.</p>

<ul>
  <li>Management Rendezvous Server - Used to designate the Service Node
Management Rendezvous, it will proxy management traffic between NSX
Controller Cluster and remote NSX Gateways.</li>
  <li>Admin Status Enabled - Used to enable or disable the Transport Node.</li>
  <li>Tunnel Keep Alive Spray - Used to improve the health testing of
transport nodeâ€™s tunnels.</li>
</ul>

<p>For our lab leaving the default values will suffice.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/04/screen-shot-2014-04-29-at-00-55-46.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-04-29-at-00-55-46.png?w=580" alt="Screen Shot 2014-04-29 at
00.55.46" /></a></p>

<p>For the next step get the SSL certificate from the Service Node.
Establish an SSH session with the appliance as <code>admin</code> user and use the
<code>show switch certificate</code> command. The output of the command can be a
bit large, we just need the certificate itself.</p>

<pre><code>-----BEGIN CERTIFICATE-----
MIIDgjCCAmoCAQMwDQYJKoZIhvcNAQEEBQAwgYExCzAJBgNVBAYTAlVTMQswCQYD
VQQIEwJDQTEVMBMGA1UEChMMT3BlbiB2U3dpdGNoMREwDwYDVQQLEwhzd2l0Y2hj
YTE7MDkGA1UEAxMyT1ZTIHN3aXRjaGNhIENBIENlcnRpZmljYXRlICgyMDE0IEFw
ciAyNyAyMzoyMDowNSkwHhcNMTQwNDI3MjMyMDUzWhcNMjQwNDI0MjMyMDUzWjCB
izELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRUwEwYDVQQKEwxPcGVuIHZTd2l0
Y2gxHzAdBgNVBAsTFk9wZW4gdlN3aXRjaCBjZXJ0aWZpZXIxNzA1BgNVBAMTLmNs
aWVudCBpZDpjYWIwNWU2OS1iZjI5LTRkMjItYTY1Ny0zYTJhZThkNjgyY2MwggEi
MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC9lAk6DZWO/miggjjXk4xQd3hv
ieTPpjklw6Q4UKW+qMt0GjhC06n/cVK4kR12v1aCcxsKWmPK8LC1vU68e2T61zLe
NjRYHfa9VhqKjAY5p9xPcmQGli8+Cff47LfUVylEA+74YNMDHCuJbMagtwJOXSUa
UpaB3EnsEu6C4d4RzMBn55tlDbWAuFojH9JAki3g4maMqJRhILRUYoUFoSknmUvC
8cm719TcXw4u5cAzNBC2mMv6uRuDd+l1VquhFkksP2Di3D0/kI2yBW7lgDRTE4fn
O8hLasNPuGg24mOAkW/OIvusieW2MSqEwhGV5+G4fRgbRAI1ijTRT1K4dZuhAgMB
AAEwDQYJKoZIhvcNAQEEBQADggEBAB5bqYe2LXlIbwHSx1j28d/5FBmGxMd5LUEB
h29B+nTj3wVZkZpIxFoP/QRhzMXPWGM1PeixWN9o8oSZfrCEA7yMcn3uMMwdAmNz
7eNv4svw19hccWEvdNRBkQKdDX1YKItwUJKqVMJnI2dCqsGD4H1R9uwU+QJuEIgm
VMEoHYq7TwQXX6TR1eebjOKdeg4laOcsKystHTW+wuMBfOfcoYIuEZMQ7SOsRANe
l1hm3VI7t1gxp38r9JbtEC2jCqqBMzR+ZrzmodLsn/VgFDv8QiUZ5tFHaWl+jhQ/
JWxXqjLo42B6fRUA04wF6tJKnu3KDaVFIx4ssvKw2Q5u6PNSf8I=
-----END CERTIFICATE-----
</code></pre>

<p>Go back to the <em>Create Service Node</em> window and select <em>Security
Certificate</em> as credential type and paste the certificate extracted from
the Service Node in the <em>Security Certificate</em> text area.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/04/screen-shot-2014-04-29-at-01-08-43.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-04-29-at-01-08-43.png?w=580" alt="Screen Shot 2014-04-29 at
01.08.43" /></a></p>

<p>The final step is to setup the <em>Transport Connectors</em>. Click <em>Add
Connector</em>.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/04/screen-shot-2014-04-29-at-01-15-22.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-04-29-at-01-15-22.png?w=580" alt="Screen Shot 2014-04-29 at
01.15.22" /></a></p>

<p>In the <em>Create Transport Connector</em> screen select STT as the <em>Transport
Type.</em> Select the transport zone the we created before and enter the IP
address of the Service Node.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/04/screen-shot-2014-04-29-at-01-20-01.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-04-29-at-01-20-01.png?w=300" alt="Screen Shot 2014-04-29 at
01.20.01" /></a></p>

<p>Once the Connector is create click Save in the final screen and the new
Service Node will be added to the NSX Controller.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/04/screen-shot-2014-04-29-at-01-25-08.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-04-29-at-01-25-08.png?w=580" alt="Screen Shot 2014-04-29 at
01.25.08" /></a></p>

<p>Now we need to finish the Gateway appliance configuration in a similar
way as we did with the Service Node. Again from the Dashboard and the
<em>Summary of Transport Components</em> section, launch the <em>Create Gateway</em>
by clicking the Add button in the Gateways row. The rest of the steps
are very similar to the Service Node process.</p>

<ul>
  <li>Select Gateway as <em>Transport Node Type</em></li>
  <li>Get the SSL certificate from NSX Gateway with the
<code>show switch certificate</code> command.</li>
  <li>Configure the credentials using the SSL certificate</li>
  <li>Create an STT Transport Connector and set the IP address of the
Gateway</li>
</ul>

<p>All the above Transport Node related tasks can be achieved through the
command line by using the <code>request transport-node-register</code> command.
This is a hidden command that can be used to register Service Nodes or
Gateways in a NSX Controller Cluster. According to NSX documentation
there are two versions of the command:</p>

<ul>
  <li>cert - Used for production environments</li>
  <li>mgmt-ip - Used for testing environments</li>
</ul>

<p>The first one will transmit the encoded PEM certificates to the NSX
Controller while the second will use the appliance management IP as the
credential. The arguments for both versions are:</p>

<ul>
  <li><code>controller-ip-url</code> - Switch manager address of the NSX Controller
Cluster, accepts IP or hostname and the TCP port to connect to.</li>
  <li><code>ctrler-username</code> - NSX administration account for the Controller.</li>
  <li><code>ctrler-password</code> - NSX administration account password.</li>
  <li><code>mgmt-ip</code> - The IP address of the transport node.</li>
  <li><code>cert</code> - As we detailed before this one is exclusive of mgmt-ip
and viceversa.</li>
  <li><code>rendezvous-yes-or-no</code> - Simply pass yes or no to indicate that the
transport node is a Management Rendezvous Server one.</li>
  <li><code>tc-ip-address</code> - IP address of the transport nodeÂ  connector.</li>
  <li><code>tc-zone.uuid</code> - Transport Zone to be associated with the
transport node.</li>
  <li><code>tc-type</code> - Encapsulation format for the transport nodeâ€™s
transport connector.</li>
</ul>

<p>With those arguments a registering command for our Service Node would be
like this.</p>

<pre><code>request transport-node-register nsxc.vlab.local admin admin mgmt-ip no tc-id 192.168.82.46 tc-uuid b948fd35-5737-4a30-8741-43134771d40c tc-type STT
</code></pre>

<h4 id="create-a-gateway-service">Create a Gateway Service</h4>

<p>The next step would be to setup a Gateway Service. My lab lives within
VMware Fusion and for now I donâ€™t really need an L2 or L3 Gateway
Service but since the purpose of this post is to illustrate NSX I decide
to configure one and let everything in place for a future expansion of
the lab.</p>

<p>Remember that Gateway services can be of two types:</p>

<ul>
  <li>L2 Gateway Service - Will expand logical network by connecting it to
a physical L2 segment.</li>
  <li>L3 Gateway Service - Connects virtual router ports to physical to
physical IP networks.</li>
</ul>

<p>Itâ€™s important to note that in an NSX deployment you may connect only
one Gateway Service, either L2 or L3, to a given L2 physical segment.</p>

<h5 id="l3-service-setup">L3 Service Setup</h5>

<p>From NSX Manager Dashboard go to <em>Summary of Transport Components</em>
section and in <em>Gateway Services</em> click <em>Add</em>. In the first step of the
Create Gateway Service wizard select the <strong>L3 Gateway Service</strong> from the
drop-down menu.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-03-at-13-11-51.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-03-at-13-11-51.png?w=580" alt="Screen Shot 2014-05-03 at
13.11.51" /></a></p>

<p>In the second step configure the <em>Display Name</em> for the new service and
click <em>Next</em>.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-03-at-13-15-36.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-03-at-13-15-36.png?w=580" alt="Screen Shot 2014-05-03 at
13.15.36" /></a></p>

<p>The third and final step is to bind our previously configured gateway
node to the service. Click <em>Add Gateway</em>.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-03-at-13-25-28.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-03-at-13-25-28.png?w=580" alt="Screen Shot 2014-05-03 at
13.25.28" /></a></p>

<p>In the <em>Edit Gateway</em> pop-up select the UUID of the gateway node and the
network interface to be used, leave the <em>Failure Zone ID</em> field blank.
This last field is used for high availability of L3 services, I will try
to write about this subject in a future post.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-03-at-13-27-17.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-03-at-13-27-17.png?w=300" alt="Screen Shot 2014-05-03 at
13.27.17" /></a></p>

<p>Click <em>Save &amp; View</em> and check the newly created Gateway Service.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-03-at-13-40-48.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-03-at-13-40-48.png?w=580" alt="Screen Shot 2014-05-03 at
13.40.48" /></a></p>

<h5 id="l2-service-setup">L2 Service Setup</h5>

<p>To create a new L2 Gateway Service follow the same procedure as with L3
one and launch the <em>Create Gateway Service</em> wizard.</p>

<ul>
  <li>Select <em>L2 Gateway Service</em>.</li>
  <li>Enter the name of the new service.</li>
  <li>Add the gateway and fill in the UUID and network interface fields,
this screen is slightly different since there is no Failure Zone
ID field.</li>
</ul>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-03-at-19-06-50.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-03-at-19-06-50.png?w=300" alt="Screen Shot 2014-05-03 at
19.06.50" /></a></p>

<p>Please have in mind that the example of the above screenshot will fail
because you cannot use the same gateway appliance for two different L2
or L3 Gateway Services, if you need an L2 service deploy a new gateway
node and configure it following the above steps.</p>

<p>With this step our Transport Network is almost setup, the only part left
would be to add the hypervisors to the Controller Cluster but Iâ€™ll left
that part for the next article.</p>

<h3 id="nsx-logical-network-view">NSX Logical Network View</h3>

<p>In any typical OpenStack deployment the logical network elements will
usually be created and configured not through the NSX Manager but NVP
API. The API would be called by OpenStack Neutron module using the
neutron plugin for VMware NSX either from Horizon dashboard or Neutron
command line. However I decided to explain how to create and configure
the different Logical Layer elements from NSX Manager.</p>

<p>Before starting with a simple walk-through of the process we need first
to describe the different elements of the Logical Network. NSX Logical
Network provide a similar functionality of a dedicated Ethernet switch.
It recreates entities like switches, routers and ports and provides
management functionality for them through NVP API.</p>

<ul>
  <li><strong>Logical Switch</strong> - Recreates an Ethernet-type L2 service-model,
containing logical switch ports that can be configured to implement
a set of security and QoS policies.</li>
  <li><strong>Logical Router</strong> - Provides L3 routing services for the
logical network. Can be configured to offer other services such as
NAT and routed connections to the external physical network.</li>
  <li><strong>Logical Switch Port</strong> - Represents and provides a logical
connection point for virtual machines network interfaces (VIF),
router patch connections or an L2 gateway connection to an
external network.</li>
  <li><strong>Logical Router Port</strong> - Provides the logical connection point for
a patch connection to a switch or L3 gateway connections.</li>
  <li><strong>Logical Port Attachment</strong> - This is the logical equivalent of
connecting a network cable between an interface and a switch port.</li>
</ul>

<h4 id="create-a-logical-switch">Create a Logical Switch</h4>

<p>Letâ€™s start from the begging and create a Logical Switch. From <em>Summary
of Logical Components</em> are in the <em>Dashboard</em> screen click <em>Add</em> in the
Switches row.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-05-at-22-09-20.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-05-at-22-09-20.png" alt="Screen Shot 2014-05-05 at
22.09.20" /></a></p>

<p>Provide the name of new switch and click <em>Next</em>.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-05-at-22-14-23.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-05-at-22-14-23.png?w=580" alt="Screen Shot 2014-05-05 at
22.14.23" /></a></p>

<p>In <em>Properties</em> there are two different settings:</p>

<ul>
  <li>Port Isolation Enabled - This setting basically disables VM to VM
communication by preventing communication between the different
logical ports of the switch.</li>
  <li>Replication Mode - Determines which transport node handle
replication of broadcast, unknown-unicast and multicast (BUM)
traffic. There are two possible values:
    <ul>
      <li>Service Node - Traffic is sentÂ  to the NSX Service Node to be
flooded to L2 logical segment. This is the default and
recommended setting.</li>
      <li>Source Node - BUM traffic is handled directly by the source
hypervisor instead of a Service Node.</li>
    </ul>
  </li>
</ul>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-05-at-22-16-54.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-05-at-22-16-54.png?w=580" alt="Screen Shot 2014-05-05 at
22.16.54" /></a></p>

<p>Next specify the transport binding for the logical switch. Click <em>Add
Binding</em> and select the <em>Transport Type</em> and the <em>Transport Zone UUID</em>.
Iâ€™ve selected STT our previously created transport zone respectively.
For the transport type there are several types available:</p>

<ul>
  <li>STT</li>
  <li>GRE</li>
  <li>Bridge</li>
  <li>IPsec GRE</li>
  <li>IPsec STT</li>
  <li>VXLAN</li>
</ul>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-05-at-22-27-11.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-05-at-22-27-11.png?w=300" alt="Screen Shot 2014-05-05 at
22.27.11" /></a></p>

<p>Click <em>Save &amp; View</em> to review our new logical switch, leave the router
connection for later.</p>

<h4 id="add-logical-switch-ports">Add Logical Switch Ports</h4>

<p>Once one or more logical switches have been created we can start adding
ports to them. Ports will provide connection points to our virtual
machines. Click <em>Add</em> in the <em>Logical Ports</em> row and the <em>Create Logical
Switch Port</em> wizard will be started.</p>

<p>Select the Logical Switch the port will belong to.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-05-at-22-57-21.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-05-at-22-57-21.png?w=580" alt="Screen Shot 2014-05-05 at
22.57.21" /></a></p>

<p>In <em>Basics</em> provide a descriptive name for the port, I tend to use the
convention <code>vm_name-port</code>.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-05-at-23-01-00.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-05-at-23-01-00.png?w=580" alt="Screen Shot 2014-05-05 at
23.01.00" /></a></p>

<p>In the <em>Properties</em> screen you have the following filed available:</p>

<ul>
  <li>Port number - Optional parameter.</li>
  <li>Admin Status Enabled - Enabled by default.</li>
  <li>Logical Queue UUID - An optional parameter used to link the port to
a QOS policy.</li>
</ul>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-05-at-23-07-01.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-05-at-23-07-01.png?w=580" alt="Screen Shot 2014-05-05 at
23.07.01" /></a></p>

<p>Leave the <em>Mirror Targets</em> settings with the default values and move
forward to the <em>Attachment</em> screen. Select VIF, virtual machine
interface, as <em>Attachment Type</em>, select a hypervisor and the network
interface of the virtual machine.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-06-at-01-32-23.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-06-at-01-32-23.png?w=580" alt="Screen Shot 2014-05-06 at
01.32.23" /></a></p>

<p>Attachments can all be of type:</p>

<ul>
  <li>None</li>
  <li>Extended Network Bridge</li>
  <li>Mult-Domain Interconnect</li>
  <li>L2 Gateway</li>
  <li>Patch to logical router port</li>
  <li>VTEP L2 Gateway</li>
</ul>

<p>For example an Extended Network Bridged attachment should be configured
like this.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-06-at-01-36-12.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-06-at-01-36-12.png?w=580" alt="Screen Shot 2014-05-06 at
01.36.12" /></a></p>

<h4 id="create-a-logical-router">Create a Logical Router</h4>

<p>Launch the <em>Create Logical Router</em> dialog and set the name of the new
router in the first screen.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-06-at-01-44-19.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-06-at-01-44-19.png?w=580" alt="Screen Shot 2014-05-06 at
01.44.19" /></a></p>

<p>In Properties select the Routing Type:</p>

<ul>
  <li>Routing Table - Allows to define static routes on the logical router</li>
  <li>Single Default Route - Defines a single default route for all
traffic, routing all traffic through the L3 Gateway connecting the
router to the datacenter physical network.</li>
</ul>

<p>Tick <em>Enable NAT Synchronization</em> checkbox in order to provide NAT
service through this logical router and want NAT rules to survive in the
event of a Gateway failover.</p>

<p><em>Replication Mode</em> works in the same way as in the Logical Switch,
<em>Service Node</em> is selected by default.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-06-at-01-55-07.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-06-at-01-55-07.png?w=580" alt="Screen Shot 2014-05-06 at
01.55.07" /></a></p>

<p>Configure the <em>Distributed Logical Router</em>. If the checkbox is unticked
it means the logical router will be a <strong>centralized logical router</strong> and
all network traffic between virtual machines will be forwarded to the
NSX Service Nodes. On the contrary if you tick the checkbox it means it
will be a <strong>distributed logical router</strong> and it will provide a one-hop
routing of VM to VM traffic, to be able to use this feature all
hypervisors running VMs using this router must be in the same transport
zone.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-06-at-02-03-39.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-06-at-02-03-39.png?w=580" alt="Screen Shot 2014-05-06 at
02.03.39" /></a></p>

<p>Click <em>Save &amp; View</em> to finish the process and review the new router.
Optionally at the last step you can assign an L3 Gateway Service and
configure the corresponding Logical Router Port.</p>

<p>Select the UUID of the desired gateway service and configure the Logical
Router Port settings. In the example I choose the basic configuration
since I only need to provide the IP address for the port.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-06-at-02-12-52.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-06-at-02-12-52.png?w=580" alt="Screen Shot 2014-05-06 at
02.12.52" /></a></p>

<h4 id="add-a-logical-router-port">Add a Logical Router Port</h4>

<p>To create and assign a logical port to an existent router launch the
corresponding wizard from <em>Summary of Logical Components</em> table in the
<em>Dashboard</em> screen.</p>

<p>Select the Logical Router UUID from the drop-down.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-06-at-22-12-57.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-06-at-22-12-57.png?w=580" alt="Screen Shot 2014-05-06 at
22.12.57" /></a></p>

<p>Enter a name for the port and click Next to move to <em>Properties</em> step.
The <em>Port Number</em> and <em>MAC Address</em> fields are optional, leave <em>Admin
Status Enabled</em> checked. In the <em>IP Addresses</em> table add the required IP
address, must be in IPv4 CIDR notation.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-06-at-22-19-26.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-06-at-22-19-26.png?w=580" alt="Screen Shot 2014-05-06 at
22.19.26" /></a></p>

<p>Configure the attachment. For router ports the attachments can be set to
one of the following types:</p>

<ul>
  <li>None</li>
  <li>L3 Gateway</li>
  <li>Patch</li>
</ul>

<p>For my example lab this time I configured the attachment as a <em>Patch</em>
one. You need to select the <em>Logical Switch UUID</em> and the <em>Peer Port
UUID</em>, this peer port is port in the logical switch and you have to
configure it either before creating the router port or you can create it
at this step.</p>

<p><a href="http://jreypo.files.wordpress.com/2014/05/screen-shot-2014-05-06-at-22-36-10.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/screen-shot-2014-05-06-at-22-36-10.png?w=580" alt="Screen Shot 2014-05-06 at
22.36.10" /></a></p>

<p>Click <em>Save</em> to finish the creation process.</p>

<p>This completes the logical network part, itâ€™s a very basic setup without
any security or QOS services but I hope that you gained a better
understanding of transport and logical network concepts and the
relationships between their different components. In third part of the
series we will review how to setup the KVM hypervisor and connect it to
the NSX infrastructure. Comments, corrections or questions are always
welcome.</p>

<p>Juanma.</p>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=/cloud/linux/networking/openstack/vmware/deploying-openstack-with-kvm-and-vmware-nsx-part-2-configure-nsx-transport-and-logical-network-views/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/cloud/linux/networking/openstack/vmware/deploying-openstack-with-kvm-and-vmware-nsx-part-2-configure-nsx-transport-and-logical-network-views/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/cloud/linux/networking/openstack/vmware/deploying-openstack-with-kvm-and-vmware-nsx-part-2-configure-nsx-transport-and-logical-network-views/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>Deploying OpenStack with KVM and VMware NSX - Part 2: Configure NSX Transport and Logical network views</strong> was published on <time datetime="2014-05-06T22:12:21+02:00">May 06, 2014</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/openstack/vmware/upgrading-vmware-integrated-openstack/" title="Upgrading VMware Integrated OpenStack">Upgrading VMware Integrated OpenStack</a></li>
    
      <li><a href="/cloud/openstack/give-me-openstack-and-give-me-liberty/" title="Give me OpenStack and give me Liberty!">Give me OpenStack and give me Liberty!</a></li>
    
      <li><a href="/linux/red%20hat/sysadmin/dnf-the-new-fedora-package-manager/" title="DNF, the new Fedora package manager">DNF, the new Fedora package manager</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    

<span>&copy; 2015 Juan Manuel Rey. <br> Hosted on <a href="https://pages.github.com" rel="nofollow" target="_blank">GitHub Pages</a> and powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>




</body>
</html>
