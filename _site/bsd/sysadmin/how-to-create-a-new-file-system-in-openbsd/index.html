<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>How to create a new file system in OpenBSD &#8211; Juanma's Blog</title>
<meta name="description" content="Another self-reference short post that can be useful for any OpenBSD newbie and because I love to go through the basics from time to time just to don’t lose my expertise.

">
<meta name="keywords" content="disklabel, newfs, OpenBSD, sysadmin, systems administration">

  

<!-- Twitter Cards -->
<meta name="twitter:title" content="How to create a new file system in OpenBSD">
<meta name="twitter:description" content="Another self-reference short post that can be useful for any OpenBSD newbie and because I love to go through the basics from time to time just to don’t lose my expertise.

">
<meta name="twitter:site" content="@jreypo">
<meta name="twitter:creator" content="@jreypo">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="How to create a new file system in OpenBSD">
<meta property="og:description" content="Another self-reference short post that can be useful for any OpenBSD newbie and because I love to go through the basics from time to time just to don’t lose my expertise.

">
<meta property="og:url" content="/bsd/sysadmin/how-to-create-a-new-file-system-in-openbsd/">
<meta property="og:site_name" content="Juanma's Blog">

<meta property="og:image" content="/images/default-thumb.png">






<link rel="canonical" href="/bsd/sysadmin/how-to-create-a-new-file-system-in-openbsd/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Juanma's Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/">Juanma's Blog</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="/about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="/posts/" >Posts</a></li>
				
				    
				        
				    
				    <li><a href="/vmware-hp-links/" >HP Resources for VMware</a></li>
				
				    
				        
				    
				    <li><a href="/tags/" >Tags</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    
  

<div itemscope itemtype="http://schema.org/Person">


	<img src="/images/bio-photo-2.jpg" class="bio-photo" alt="Juan Manuel Rey bio photo">


  <h3 itemprop="name">Juan Manuel Rey</h3>
  <p>Unix Geek. Sysadmin by heart turned cloud architect for VMware.</p>
  <a href="mailto:Juan Manuel Rey" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
  <a href="http://twitter.com/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  <a href="http://plus.google.com/+JuanManuelReyPortal" class="author-social" target="_blank"><i class="fa fa-fw fa-google-plus-square"></i> Google+</a>
  <a href="http://linkedin.com/in/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  
  
  <a href="http://github.com/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  <a href="http://stackoverflow.com/users/2454288/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> Stackoverflow</a>
  
  
  
  
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="/bsd/sysadmin/how-to-create-a-new-file-system-in-openbsd/" rel="bookmark" title="How to create a new file system in OpenBSD">How to create a new file system in OpenBSD</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>Another self-reference short post that can be useful for any <a href="http://www.openbsd.org" title="OpenBSD">OpenBSD</a> newbie and because I love to go through the basics from time to time just to don’t lose my expertise.</p>

<p>Also I’ll explain the basics about how disks and partitions are managed in OpenBSD</p>

<h3 id="identify-and-prepare-the-disk">Identify and prepare the disk</h3>

<p>There are two types of disks common to most platform where OpenBSD can run:</p>

<ul>
  <li>IDE disks. Identified as <code>wdX</code></li>
  <li>SCSI disks and devices that use SCSI commands. Identified as <code>sdX</code>. This category includes also the USB and SATA disks.</li>
</ul>

<p>Our disk for this example will be a SCSI one, sd3. Using <code>dmesg</code> check that the system has recognized the device.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">[root@obsd ~]# dmesg |grep SCSI
sd0 at scsibus1 targ 0 lun 0: &lt;VMware,, VMware Virtual S, 1.0&gt; SCSI2 0/direct fixed
sd1 at scsibus1 targ 1 lun 0: &lt;VMware,, VMware Virtual S, 1.0&gt; SCSI2 0/direct fixed
sd2 at scsibus1 targ 2 lun 0: &lt;VMware,, VMware Virtual S, 1.0&gt; SCSI2 0/direct fixed
sd3 at scsibus1 targ 3 lun 0: &lt;VMware,, VMware Virtual S, 1.0&gt; SCSI2 0/direct fixed
[root@obsd ~]#</code></pre></div>

<p>Next initialize the MBR of the disk using the default template. Use <code>fdisk -i</code> to perform the task.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">[root@obsd ~]# fdisk -i sd3
Do you wish to write new MBR and partition table? [n] y
Writing MBR at offset 0.
[root@obsd ~]# fdisk sd3
Disk: sd3       geometry: 1044/255/63 [16777216 Sectors]
Offset: 0       Signature: 0xAA55
            Starting         Ending         LBA Info:
 #: id      C   H   S -      C   H   S [       start:        size ]
-------------------------------------------------------------------------------
 0: 00      0   0   0 -      0   0   0 [           0:           0 ] unused     
 1: 00      0   0   0 -      0   0   0 [           0:           0 ] unused     
 2: 00      0   0   0 -      0   0   0 [           0:           0 ] unused     
*3: A6      0   1   2 -   1043 254  63 [          64:    16771796 ] OpenBSD    
[root@obsd ~]#</code></pre></div>

<p>As it can be seen the partition number 3 has been initialize as OpenBSD. In the example we are using the whole disk for OpenBSD, if not you should enter in edition mode with <code>fdisk -i &lt;disk&gt;</code> and partition the disk appropriately.</p>

<h3 id="partition-the-disk-using-disklabel">Partition the disk using disklabel</h3>

<p>Here you can be confused, because really we are going to partition the partition. These partition are also known as <strong>Filesystem Partitions</strong> since is on top of them where the filesystems and swap devices are created. And the <code>fdisk</code> partitions are known as <strong>MBR Partitions</strong>.</p>

<p>In other BSD systems, like FreeBSD, these partitions are called slices however in OpenBSD historically have been called also partitions which have lead to some confusion.</p>

<p><code>disklabel</code> partitions are identified by appending a letter to the disk identifier, like <code>sd3a</code> which represents the first partition of the SCSI disk 3. There are some reserved letters:</p>

<ul>
  <li><code>a</code> - represents always the root partition of the disk.</li>
  <li><code>b</code> - is always use a swap device.</li>
  <li><code>c</code> - represents the whole disk.</li>
</ul>

<p>And finally here it is an example on how to create a filesystem partition. Use <code>disklabel -E &lt;disk&gt;</code> to edit the disk.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">[root@obsd ~]# disklabel -E sd3
Label editor (enter &#39;?&#39; for help at any prompt)
&gt; p
OpenBSD area: 64-16771860; size: 16771796; free: 16771796
#                size           offset  fstype [fsize bsize  cpg]
  c:         16777216                0  unused                  
&gt; a a
offset: [64]
size: [16771796]
FS type: [4.2BSD]
&gt; p
OpenBSD area: 64-16771860; size: 16771796; free: 20
#                size           offset  fstype [fsize bsize  cpg]
  a:         16771776               64  4.2BSD   2048 16384    1
  c:         16777216                0  unused                  
&gt; q
Write new label?: [y] y
[root@obsd ~]#
[root@obsd ~]# disklabel sd3
# /dev/rsd3c:
type: SCSI
disk: SCSI disk
label: VMware Virtual S
uid: 2462f082e9092afc
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 255
sectors/cylinder: 16065
cylinders: 1044
total sectors: 16777216
boundstart: 64
boundend: 16771860
drivedata: 0

16 partitions:
#                size           offset  fstype [fsize bsize  cpg]
  a:         16771776               64  4.2BSD   2048 16384    1
  c:         16777216                0  unused                  
[root@obsd ~]#</code></pre></div>

<h3 id="create-the-file-system">Create the file system</h3>

<p>Use <code>newfs</code> against the special raw device file to create the file system. By default OpenBSD uses the 4.3BSD file system to build file systems with backward compatibility with older boot ROMS, however it also support Fast File System (FFS) as the default format for filesystem smaller that 1TB and Enhanced Fast File System (FFS2) for file systems larger than 1TB.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">[root@obsd ~]# newfs /dev/rsd3a
/dev/rsd3a: 8192.0MB in 16777216 sectors of 512 bytes
41 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
super-block backups (for fsck -b #) at:
 32, 414688, 829344, 1244000, 1658656, 2073312, 2487968, 2902624, 3317280, 3731936, 4146592, 4561248, 4975904, 5390560, 5805216, 6219872, 6634528, 7049184, 7463840, 7878496, 8293152, 8707808, 9122464,
 9537120, 9951776, 10366432, 10781088, 11195744, 11610400, 12025056, 12439712, 12854368, 13269024, 13683680, 14098336, 14512992, 14927648, 15342304, 15756960, 16171616, 16586272,
[root@obsd ~]#</code></pre></div>

<p>Next you can mount your newly created file system like any other Unix system.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">[root@obsd ~]# mkdir /data
[root@obsd ~]# mount /dev/sd3a /data
[root@obsd ~]#
[root@obsd ~]# df -h
Filesystem     Size    Used   Avail Capacity  Mounted on
/dev/sd0a      5.8G   43.1M    5.4G     1%    /
/dev/sd0d      508M   10.4M    472M     2%    /home
/dev/sd0f     1001M    6.0K    951M     0%    /tmp
/dev/sd0g     25.3G    625M   23.4G     3%    /usr
/dev/sd0e      1.9G    5.1M    1.8G     0%    /var
/dev/sd3a      7.9G    2.0K    7.5G     0%    /data
[root@obsd ~]#</code></pre></div>

<p>And of course you can add it to the <code>/etc/fstab</code> file to provide persistence through a reboot of the system.</p>

<p>Juanma.</p>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=/bsd/sysadmin/how-to-create-a-new-file-system-in-openbsd/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/bsd/sysadmin/how-to-create-a-new-file-system-in-openbsd/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/bsd/sysadmin/how-to-create-a-new-file-system-in-openbsd/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>How to create a new file system in OpenBSD</strong> was published on <time datetime="2011-03-07T15:45:57+01:00">March 07, 2011</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/openstack/vmware/upgrading-vmware-integrated-openstack/" title="Upgrading VMware Integrated OpenStack">Upgrading VMware Integrated OpenStack</a></li>
    
      <li><a href="/cloud/openstack/give-me-openstack-and-give-me-liberty/" title="Give me OpenStack and give me Liberty!">Give me OpenStack and give me Liberty!</a></li>
    
      <li><a href="/linux/red%20hat/sysadmin/dnf-the-new-fedora-package-manager/" title="DNF, the new Fedora package manager">DNF, the new Fedora package manager</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    

<span>&copy; 2015 Juan Manuel Rey. <br> Hosted on <a href="https://pages.github.com" rel="nofollow" target="_blank">GitHub Pages</a> and powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>




</body>
</html>
