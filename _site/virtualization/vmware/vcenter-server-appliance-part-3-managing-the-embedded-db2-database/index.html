<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>vCenter Server Appliance. Part 3 - Managing the embedded DB2 database &#8211; Juanma's Blog</title>
<meta name="description" content="In this last post about the vCenter Server Appliance we will see a
glimpse on how to manage the embedded database that comes bundle with
the VCSA.

">
<meta name="keywords" content="IBM DB2, SLES 11, SuSE Linux, vCenter Server, vCenter Server Appliance, VCSA, VMware, vSphere 5">

  

<!-- Twitter Cards -->
<meta name="twitter:title" content="vCenter Server Appliance. Part 3 - Managing the embedded DB2 database">
<meta name="twitter:description" content="In this last post about the vCenter Server Appliance we will see a
glimpse on how to manage the embedded database that comes bundle with
the VCSA.

">
<meta name="twitter:site" content="@jreypo">


<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="vCenter Server Appliance. Part 3 - Managing the embedded DB2 database">
<meta property="og:description" content="In this last post about the vCenter Server Appliance we will see a
glimpse on how to manage the embedded database that comes bundle with
the VCSA.

">
<meta property="og:url" content="/virtualization/vmware/vcenter-server-appliance-part-3-managing-the-embedded-db2-database/">
<meta property="og:site_name" content="Juanma's Blog">

<meta property="og:image" content="/images/default-thumb.png">






<link rel="canonical" href="/virtualization/vmware/vcenter-server-appliance-part-3-managing-the-embedded-db2-database/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Juanma's Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/">Juanma's Blog</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="/about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="/posts/" >Posts</a></li>
				
				    
				        
				    
				    <li><a href="/vmware-hp-links/" >HP Resources for VMware</a></li>
				
				    
				        
				    
				    <li><a href="/tags/" >Tags</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    
  

<div itemscope itemtype="http://schema.org/Person">


	<img src="/images/" class="bio-photo" alt=" bio photo">


  <h3 itemprop="name"></h3>
  <p></p>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="/virtualization/vmware/vcenter-server-appliance-part-3-managing-the-embedded-db2-database/" rel="bookmark" title="vCenter Server Appliance. Part 3 - Managing the embedded DB2 database">vCenter Server Appliance. Part 3 - Managing the embedded DB2 database</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>In this last post about the vCenter Server Appliance we will see a
glimpse on how to manage the embedded database that comes bundle with
the VCSA.</p>

<p>First I must say that <strong>I AM NOT A DB2 ADMIN</strong>. I got this info by
playing with the VCSA in my homelab, digging a bit into the DB2
documentation and googling a lot. Use the information provided in this
post at your own risk.</p>

<p>If you still want to risk the integrity of your precious appliance
please keep reading :-)</p>

<h4 id="disassembling-the-database-installation">“Disassembling” the database installation</h4>

<p>Before starting to launch commands against the database we need to know
a bit about it. Since this is SuSE Linux check the rpm packages
installed.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb.png" alt="image" title="image" /></a></p>

<p>Now that we now it is DB2 Express version 9.7.2-1, list the files in the
package.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image1.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb1.png" alt="image" title="image" /></a></p>

<p>This is very interesting, the package doesn’t contain the database but
the installation files. The reason for this is very simple, by default
DB2 is not installed in the appliance. The Web UI gives you the option
to use an Oracle external database or an embedded one.</p>

<p>When you select <em>embedded</em> and click <em>Save Settings</em> is when VCSA starts
the installation and configuration of the database. Change to
<strong>/opt/db2/db2expc_9.7.2_install</strong> and look at the contents.</p>

<p>There are four are files, the same showed by the <em>rpm</em> command.</p>

<ul>
  <li><strong>db2exc_972_LNX_x86_64.tar.gz</strong> - The DB2 database itself.</li>
  <li><strong>do_db2_install</strong> - The installation script.</li>
  <li><strong>db2_create_script.sql</strong> - SQL script used by the installation
script to create the vCenter database and the schema.</li>
  <li><strong>db2expc.rsp</strong> - An answer file used during the installation.</li>
</ul>

<p>Feel free to take a more detailed look at the files.</p>

<p>Now move to the parent directory, <strong>/opt/db2</strong>, here you will find the
installation directory and two links named <em>current</em> and <em>home</em>. The
first will always point to the latest installed version and the second
to the home directory for the db2 user. We’ll see more about this user
later.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image2.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb2.png" alt="image" title="image" /></a></p>

<p>Change to <em>current</em> and the database directory structure will show up.
There is a <em>logs</em> symlink, this link point the installation log
directory.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image3.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb3.png" alt="image" title="image" /></a></p>

<p>The log file is called <strong>db2install.history</strong> again my advice is to
review this log file, along with the installation files it can be a real
learning experience about the DB2 installation process.</p>

<h4 id="identifying-the-database">Identifying the database</h4>

<p>OK we know how the database was installed now we need to know how it
works. Check for the DB2 processes.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image4.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb4.png" alt="image" title="image" /></a></p>

<p>Apart from root there are three other users:</p>

<ul>
  <li>db2inst1</li>
  <li>db2fenc1</li>
  <li>dasusr1</li>
</ul>

<p>Look for these users in <strong>/etc/passwd</strong>.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image5.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb5.png" alt="image" title="image" /></a></p>

<p>The user <strong>db2inst1</strong> is the only one who has a login shell, this is the
database admin user.</p>

<p>The home directory for the three users is the same that symlink <em>home</em>
pointed at in <strong>/opt/db2</strong>. This is where the DB2 environment is loaded
from.</p>

<p>Make yourself <strong>db2inst1</strong> to load the DB2 environment. For the majority
of the operations we will use the <strong>db2</strong> command. Db2 is the <strong>IBM DB2
Command Line Processor</strong>, it runs SQL statements against the database
and it can be used in interactive mode, command mode and batch
processing mode.</p>

<p>First thing is to know which DB2 version is installed. Use the <em>db2ls</em>
command.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image6.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb6.png" alt="image" title="image" /></a></p>

<p>As you can see the VCSA is running IBM DB2 9.7.0 FixPack 2. The Install
Path is also displayed.</p>

<p>Next is checking DB2 database manager. Use the <em>db2start</em> command to
check if the manager is running.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image7.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb7.png" alt="image" title="image" /></a></p>

<p>Try to stop the manager with <em>db2stop</em>.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image8.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb8.png" alt="image" title="image" /></a></p>

<p>Since the vCenter database is active the operation is not allowed, to
force the stop use <em>db2stop force</em>.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image9.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb9.png" alt="image" title="image" /></a></p>

<p>Then start again the database manager.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image10.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb10.png" alt="image" title="image" /></a></p>

<p>We are going now to get the running instances. There are two commands to
perform this operation. <em>db2ilist</em> and <em>db2 get instance</em>.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image11.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb11.png" alt="image" title="image" /></a></p>

<p>As you probably know many databases can be created within the same
instance so we are going to list the databases created.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image12.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb12.png" alt="image" title="image" /></a></p>

<p>As expected only one database is created and its name is VCDB…
Surprise!</p>

<p>In a DB2 installation we can also list the active databases, of course
in the VCSA only one will be active.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image13.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb13.png" alt="image" title="image" /></a></p>

<p>Open a connection to the database and retrieve connection state.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image14.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb14.png" alt="image" title="image" /></a></p>

<p>Once the connection is established we can get detailed information about
the database, using again the db2 command line processor.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image15.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb15.png" alt="image" title="image" /></a></p>

<p>List the tablespaces of the database.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image16.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb16.png" alt="image" title="image" /></a></p>

<p>There are many more options available within db2 utility, I’ll let up to
you to investigate them further.</p>

<h4 id="querying-the-db2-database">Querying the DB2 database</h4>

<p>The final part of our trip is to interrogate the DB2 database. We will
use the <strong>isql</strong> utility, that comes bundles with the VCSA, to perform a
few basic SQL queries. This tool is part of the
<a href="http://www.unixodbc.org/">unixODBC</a> project, you can find more about it
in their website.</p>

<p>And again we will use the db2 command line processor.</p>

<p><strong>- isql</strong></p>

<p>You don’t need <strong>db2inst1</strong> user to use <em>isql</em>, being <strong>root</strong> will
suffice. To connect to the vCenter database first we need the <strong>vc</strong>
user credentials. This is not a system user but a database one.</p>

<p>To get vc user password list the contents of
<strong>/etc/vmware-vpx/embedded_db.cfg</strong>.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image17.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb17.png" alt="image" title="image" /></a></p>

<p>The <em>EMB_DB_PASSWORD</em> variable contains the password.</p>

<p>Open a connection to the database passing the database ID, user and
password as arguments.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image18.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb18.png" alt="image" title="image" /></a></p>

<p>Now we will interrogate the database tables. Please take into account
that in my installation these tables are empty since this a lab
environment, in a production one they will be populated.</p>

<p>If you want to know which tables are created have a look at the SQL file
<strong>VCDB_db2.sql</strong>. This file is in the vCenter Server media, the Windows
one, in the <strong>vCenter-Server\dbschema</strong> folder. This file is used by
the Windows-based vCenter to create the database schema during the
installation process when it is connected to an IBM DB2 database.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image19.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb19.png" alt="image" title="image" /></a></p>

<p>Following are a couple of SQL commands you can use. Feel free to
investigate the above file, I found it very helpful to understand how he
vCenter database is constructed.</p>

<p>Get contents of <em>vpx_product</em> and <em>vpx_version</em> tables.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image20.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb20.png" alt="image" title="image" /></a></p>

<p>Get the virtual datacenter ID, contained in the <em>vpx_datacenter</em> table.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image21.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb21.png" alt="image" title="image" /></a></p>

<p><strong>- db2 command line processor</strong></p>

<p>Make yourself <em>db2inst1</em> user and launch the <strong>db2</strong> shell.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image22.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb22.png" alt="image" title="image" /></a></p>

<p>Connect to the database using the same <strong>connect to VCDB</strong> statement we
saw in the previous section.</p>

<p>Now we can run our SQL queries. In <strong>db2</strong> there is no need to end the
command with ‘;’ as we did in <strong>isql</strong>.</p>

<p>For the tables you need to prefix the tables with <strong>vc</strong>, the owner of
the tables.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image23.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb23.png" alt="image" title="image" /></a></p>

<p>Or set the schema at the beginning.</p>

<p><a href="http://jreypo.files.wordpress.com/2011/12/image24.png"><img src="%7B%7B%20site.baseurl%20%7D%7D/assets/image_thumb24.png" alt="image" title="image" /></a></p>

<p>And with this we are done with the vCenter Server Appliance series. Hope
it will be of help for any of you my dear readers. Please feel free to
comment with questions, corrections or any additional tip.</p>

<p>Juanma.</p>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=/virtualization/vmware/vcenter-server-appliance-part-3-managing-the-embedded-db2-database/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/virtualization/vmware/vcenter-server-appliance-part-3-managing-the-embedded-db2-database/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/virtualization/vmware/vcenter-server-appliance-part-3-managing-the-embedded-db2-database/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>vCenter Server Appliance. Part 3 - Managing the embedded DB2 database</strong> was published on <time datetime="2011-12-02T12:35:11+01:00">December 02, 2011</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/openstack/vmware/upgrading-vmware-integrated-openstack/" title="Upgrading VMware Integrated OpenStack">Upgrading VMware Integrated OpenStack</a></li>
    
      <li><a href="/cloud/openstack/give-me-openstack-and-give-me-liberty/" title="Give me OpenStack and give me Liberty!">Give me OpenStack and give me Liberty!</a></li>
    
      <li><a href="/linux/red%20hat/sysadmin/dnf-the-new-fedora-package-manager/" title="DNF, the new Fedora package manager">DNF, the new Fedora package manager</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    

<span>&copy; 2015 Juan Manuel Rey. <br> Hosted on <a href="https://pages.github.com" rel="nofollow" target="_blank">GitHub Pages</a> and powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>




</body>
</html>
