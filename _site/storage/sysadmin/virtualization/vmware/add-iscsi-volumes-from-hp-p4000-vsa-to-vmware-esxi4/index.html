<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Add iSCSI volumes from HP P4000 VSA to VMware ESXi4 &#8211; Juanma's Blog</title>
<meta name="description" content="In today’s post I will try to explain step by step how to add an iSCSI volume from the HP Lefthand P4000 VSA to a VMware ESXi4 server.

">
<meta name="keywords" content="ESXi4, HP Lefthand, iSCSI, P4000 VSA, sysadmin, systems administration, VMware, vSphere">

  

<!-- Twitter Cards -->
<meta name="twitter:title" content="Add iSCSI volumes from HP P4000 VSA to VMware ESXi4">
<meta name="twitter:description" content="In today’s post I will try to explain step by step how to add an iSCSI volume from the HP Lefthand P4000 VSA to a VMware ESXi4 server.

">
<meta name="twitter:site" content="@jreypo">
<meta name="twitter:creator" content="@jreypo">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Add iSCSI volumes from HP P4000 VSA to VMware ESXi4">
<meta property="og:description" content="In today’s post I will try to explain step by step how to add an iSCSI volume from the HP Lefthand P4000 VSA to a VMware ESXi4 server.

">
<meta property="og:url" content="/storage/sysadmin/virtualization/vmware/add-iscsi-volumes-from-hp-p4000-vsa-to-vmware-esxi4/">
<meta property="og:site_name" content="Juanma's Blog">

<meta property="og:image" content="/images/default-thumb.png">






<link rel="canonical" href="/storage/sysadmin/virtualization/vmware/add-iscsi-volumes-from-hp-p4000-vsa-to-vmware-esxi4/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Juanma's Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/">Juanma's Blog</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="/about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="/posts/" >Posts</a></li>
				
				    
				        
				    
				    <li><a href="/vmware-hp-links/" >HP Resources for VMware</a></li>
				
				    
				        
				    
				    <li><a href="/tags/" >Tags</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    
  

<div itemscope itemtype="http://schema.org/Person">


	<img src="/images/bio-photo-2.jpg" class="bio-photo" alt="Juan Manuel Rey bio photo">


  <h3 itemprop="name">Juan Manuel Rey</h3>
  <p>Unix Geek. Sysadmin by heart turned cloud architect for VMware.</p>
  <a href="mailto:Juan Manuel Rey" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
  <a href="http://twitter.com/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  <a href="http://plus.google.com/+JuanManuelReyPortal" class="author-social" target="_blank"><i class="fa fa-fw fa-google-plus-square"></i> Google+</a>
  <a href="http://linkedin.com/in/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  
  
  <a href="http://github.com/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  <a href="http://stackoverflow.com/users/2454288/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> Stackoverflow</a>
  
  
  
  
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="/storage/sysadmin/virtualization/vmware/add-iscsi-volumes-from-hp-p4000-vsa-to-vmware-esxi4/" rel="bookmark" title="Add iSCSI volumes from HP P4000 VSA to VMware ESXi4">Add iSCSI volumes from HP P4000 VSA to VMware ESXi4</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>In today’s post I will try to explain step by step how to add an iSCSI volume from the HP Lefthand P4000 VSA to a VMware ESXi4 server.</p>

<h3 id="step-one-create-a-volume">Step One: Create a volume</h3>

<p>Lets suppose we already have a configured storage appliance, I showed how to create a cluster in my <a href="/storage/virtualization/first-hands-on-with-the-hp-lefthand-p4000-vsa/">previous post</a> so I will not repeat that part here. Open the Centralized Management Console and go to <strong>Management Group -&gt; Cluster -&gt; Volumes and Snapshots</strong>.</p>

<p><a href="/images/volumes_snapshots.png"><img src="/images/volumes_snapshots.png" alt="" /></a></p>

<p>Click on <strong>Tasks</strong> and choose <strong>New Volume</strong>.</p>

<p><a href="/images/new_volume2.png"><img src="/images/new_volume2.png" alt="" /></a></p>

<p>Enter the volume name, a small description and the size. The volume can also be assigned to any server already connected to the cluster, as we don’t have any server assigned this option can be ignored, for now.</p>

<p><a href="/images/volume_basic.png"><img src="/images/volume_basic.png" alt="" /></a></p>

<p>In the <strong>Advanced</strong> tab the volume can be assigned to an existing cluster and the RAID level, the volume type and the provisioning type can be set.</p>

<p><a href="/images/volume_advanced.png"><img src="/images/volume_advanced.png" alt="" /></a></p>

<p>When everything is configured click OK and the volume will be created. After the creation process, the new volume will be showed up in the CMC.</p>

<p><a href="/images/new_volume_created.png"><img src="/images/new_volume_created.png" alt="" /></a></p>

<p>At this point we have a new volume with some RAID protection level, none in this particular case since it’s a single node cluster. Next step is to assign the volume to a server.</p>

<h3 id="step-two-esxi-iscsi-configuration">Step Two: ESXi iSCSI configuration</h3>

<p>Connect to the chosen ESXi4 Server through vSphere Client and from the <strong>Configuration</strong> tab in the right pane go to the <strong>Networking</strong> area and click the <em>Add Networking</em> link</p>

<p><a href="/images/esxi_add_networking.png"><img src="/images/esxi_add_networking.png" alt="" /></a></p>

<p>In the <strong>Add Networking Wizard* select VMkernel as **Connection Type</strong>.</p>

<p><a href="/images/wizard.png"><img src="/images/wizard.png" alt="" /></a></p>

<p>Create a new virtual switch.</p>

<p><a href="/images/new_vswicth.png"><img src="/images/new_vswicth.png" alt="" /></a></p>

<p>Enter the <strong>Port Group Properties</strong>, in my case the label as no other properties where relevant for me.</p>

<p><a href="/images/properties.png"><img src="/images/properties.png" alt="" /></a></p>

<p>Set the IP settings, go to <strong>Summary</strong> screen and click <strong>Finish</strong>.</p>

<p><a href="/images/ip.png"><img src="/images/ip.png" alt="IP Settings" title="IP Settings" /></a></p>

<p>The newly created virtual switch will appear in the <strong>Networking</strong> area.</p>

<p><a href="/images/vswitch_created.png"><img src="/images/vswitch_created.png" alt="" /></a></p>

<p>With the new virtual switch created go to <strong>Storage Adapters</strong> there you will see an iSCSI software adapter.</p>

<p><a href="/images/iscsi_soft_adapter.png"><img src="/images/iscsi_soft_adapter.png" alt="" /></a></p>

<p>Click on properties and on the <em>General</em> tab click the <strong>Configure</strong> button and check the <strong>Enabled</strong> status box.</p>

<p><a href="/images/enable_iscsi.png"><img src="/images/enable_iscsi.png" alt="" /></a></p>

<p>Once iSCSI is enabled its properties window will be populated.</p>

<p><a href="/images/iscsi_iqn.png"><img src="/images/iscsi_iqn.png" alt="" /></a></p>

<p>Click close, the server will ask for rescan of the adapter but at this point it is not necessary so it can be skipped.</p>

<h3 id="step-threeadd-the-volume-to-the-esxi-server">Step Three: Add the volume to the ESXi server</h3>

<p>Now, that we have our volume created and the iSCSI adapter of our ESXi server activated, the next step is to add the storage to server.</p>

<p>On the HP Lefthand CMC go to the servers area add a new server.</p>

<p><a href="/images/new_server.png"><img src="/images/new_server.png" alt="" /></a></p>

<p>Add a name for the server, a small description, check the <strong>Allow access via iSCSI</strong> box and select the authentication. In the example I choose <strong>CHAP not required</strong>. With this option you only have to enter the <strong>Initiator Node Name</strong>, you can grab it from the details of the ESXi iSCSI adapter.</p>

<p><a href="/images/new_server_2.png"><img src="/images/new_server_2.png" alt="" /></a></p>

<p>To finish the process click OK and you will see the newly added server. Go to the <strong>Volume and Snapshots</strong> tab on the server configuration and from the <strong>Tasks</strong> menu assign a volume to the server.</p>

<p><a href="/images/assign_volume.png"><img src="/images/assign_volume.png" alt="" /></a></p>

<p>Select the volume created at the beginning,</p>

<p><a href="/images/assign_volume_2.png"><img src="/images/assign_volume_2.png" alt="" /></a></p>

<p>Now go back to the vSphere client and launch again the properties of the iSCSI adapter. On the <strong>Dynamic Discovery</strong> tab add the virtual IP address of the VSA cluster.</p>

<p><a href="/images/dynamic_discovery.png"><img src="/images/dynamic_discovery.png" alt="" /></a></p>

<p>Click <strong>Close</strong> and the server will ask again to rescan the adapter, now say yes and after the rescanning process the iSCSI LUN will show up.</p>

<p><a href="/images/iscsi_lun.png"><img src="/images/iscsi_lun.png" alt="" /></a></p>

<p>Now in the ESXi a new Datastore can be created with the newly configured storage. Of course the same LUN can also be used to provide shared storage for more ESXi servers and used for VMotion, HA or any other interesting VMware vSphere features. May be in another post ;-)</p>

<p>Juanma.</p>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=/storage/sysadmin/virtualization/vmware/add-iscsi-volumes-from-hp-p4000-vsa-to-vmware-esxi4/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/storage/sysadmin/virtualization/vmware/add-iscsi-volumes-from-hp-p4000-vsa-to-vmware-esxi4/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/storage/sysadmin/virtualization/vmware/add-iscsi-volumes-from-hp-p4000-vsa-to-vmware-esxi4/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>Add iSCSI volumes from HP P4000 VSA to VMware ESXi4</strong> was published on <time datetime="2010-04-17T00:17:51+02:00">April 17, 2010</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/personal/merry-christmas/" title="Merry Christmas!">Merry Christmas!</a></li>
    
      <li><a href="/hp/networking/virtualization/hp-virtual-connect-domain-setup-part-2-network-setup/" title="HP Virtual Connect Domain Setup - Part 2: Network Setup">HP Virtual Connect Domain Setup - Part 2: Network Setup</a></li>
    
      <li><a href="/hp/networking/virtualization/hp-virtual-connect-domain-setup-part-1-domain-setup-wizard/" title="HP Virtual Connect Domain Setup - Part 1: Domain Setup Wizard">HP Virtual Connect Domain Setup - Part 1: Domain Setup Wizard</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    

<span>&copy; 2015 Juan Manuel Rey. <br> Hosted on <a href="https://pages.github.com" rel="nofollow" target="_blank">GitHub Pages</a> and powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>




</body>
</html>
