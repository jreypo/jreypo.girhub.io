<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
<title type="text">Juanma's Blog</title>
<generator uri="https://github.com/jekyll/jekyll">Jekyll</generator>
<link rel="self" type="application/atom+xml" href="/feed.xml" />
<link rel="alternate" type="text/html" href="" />
<updated>2015-12-21T02:42:50+01:00</updated>
<id>/</id>
<author>
  <name>Juan Manuel Rey</name>
  <uri>/</uri>
  
</author>


  

<entry>
  <title type="html"><![CDATA[Merry Christmas!]]></title>
  <link rel="alternate" type="text/html" href="/personal/merry-christmas/" />
  <id>/personal/merry-christmas</id>
  <published>2010-12-22T17:42:17+01:00</published>
  <updated>2010-12-22T17:42:17+01:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;With this picture of our son Jaime and our lady Buffy, my wife and me wish to you and your families all the best for this Christmas and the New Year ahead.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;And I hope that Santa and the Three Wise Men bring everything you asked for your homelabs ;-)&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/jaime__buffy.jpg&quot;&gt;&lt;img src=&quot;/images/jaime__buffy.jpg&quot; alt=&quot;&quot; title=&quot;Jaime &amp;amp; Buffy&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/personal/merry-christmas/&quot;&gt;Merry Christmas!&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on December 22, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[HP Virtual Connect Domain Setup - Part 2: Network Setup]]></title>
  <link rel="alternate" type="text/html" href="/hp/networking/virtualization/hp-virtual-connect-domain-setup-part-2-network-setup/" />
  <id>/hp/networking/virtualization/hp-virtual-connect-domain-setup-part-2-network-setup</id>
  <published>2010-12-21T15:38:20+01:00</published>
  <updated>2010-12-21T15:38:20+01:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;In the &lt;a href=&quot;/hp/networking/virtualization/hp-virtual-connect-domain-setup-part-1-domain-setup-wizard/&quot;&gt;first post&lt;/a&gt;of the series I introduced to you HP Virtual Connect and showed how to use the Domain Wizard Setup to initially configure a VC domain. In the following article I will outline the use of the Network Setup Wizard and explain Virtual Connect networking concepts.&lt;/p&gt;

&lt;p&gt;Before we begin to setup the network it would be very useful to clarify the Virtual Connect port terminology.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;External port&lt;/strong&gt; - The Ethernet connectors SFP+ modules (either 1GB or 10GB), 10GBASE-CX4 and RJ-45 on the faceplate of the Ethernet module.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Stacking port&lt;/strong&gt; - These are Ethernet external ports used to connect within a Virtual Connect Domain the VC Ethernet modules. The Ethernet modules automatically identify the stacking modules.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Uplink port&lt;/strong&gt; - An external port configured within a Domain for use as a connection to the external networking equipment. These ports are defined within Virtual Connect by the enclosure name, interconnect bay that contains the module and the port number.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Uplink port set&lt;/strong&gt; - A set of uplinks ports trunked together in order to provide improved throughput and availability.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Shared uplink port&lt;/strong&gt; - This is an Ethernet uplink port that carries the traffic for multiple networks. The associated networks are mapped to a specific VLAN on the external connection, the appropriate VLAN tags are removed or added as Ethernet packets enter or leave the VC Domain.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Shared uplink port set&lt;/strong&gt; - This is a group of Ethernet uplinks trunked to provide improved throughput and availability to VC Shared Uplink Set.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The Virtual Connect Network Setup Wizard will help to establish external Ethernet connectivity for the enclosure. With this wizard you will be able to:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Identify the MAC addresses to be used by the servers within the VC Domain.&lt;/li&gt;
  &lt;li&gt;Configure Server VLAN tagging.&lt;/li&gt;
  &lt;li&gt;Set up connections from the c-Class enclosure to the external networks.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The network connections can be:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Dedicated uplink to a specific Ethernet network.&lt;/li&gt;
  &lt;li&gt;Shared uplink sets.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The first screen of the wizard is the MAC Address Settings. As every server in the market the HP Blades come with factory-default MAC addresses already assigned to their network cards. However Virtual Connect can override these values while the server remains in the enclosure.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/network_wizard_1.png&quot;&gt;&lt;img src=&quot;/images/network_wizard_1.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Virtual Connect access the NICs through the Onboard Administrator and the server iLO to manage the MAC addresses. It provides 64 predefined and reserved MAC address ranges. The wizard will give you the option to use either an HP predefined range or an user defined one. HP recommends to use the predefined ranges.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/network_wizard_2.png&quot;&gt;&lt;img src=&quot;/images/network_wizard_2.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Once you have chosen the address range and click next the wizard will ask for confirmation before continue.&lt;/p&gt;

&lt;p&gt;The next screen is &lt;strong&gt;Server VLAN Tagging Support&lt;/strong&gt;. Here the wizard gives you two possible options:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Tunnel VLAN Tags&lt;/li&gt;
  &lt;li&gt;Map VLAN Tags&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;/2010/images/network_wizard_3.png&quot;&gt;&lt;img src=&quot;/images/network_wizard_3.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The first one, &lt;strong&gt;Tunnel VLAN Tags&lt;/strong&gt;, supports only VLAN tagging on networks with dedicated uplinks where all VLAN tags passed through the VC Domain without modification and ports connected to networks using shared uplinks can only send and receive untagged frames.&lt;/p&gt;

&lt;p&gt;On the other hand &lt;strong&gt;Map VLAN Tags&lt;/strong&gt; allow you to add more than one network to an Ethernet server port and specify the VLAN mapping between server tags and VC-Enet networks. Also, the VLAN tunneling will be disabled for VC Ethernet networks with dedicated uplinks.&lt;/p&gt;

&lt;p&gt;There is also a checkbox in the page to &lt;em&gt;Force server connections to use the same VLAN mappings as shared uplink sets&lt;/em&gt;, if this option is enabled the server ports connected to multiple VC Ethernet networks are forced to use the same VLAN mappings as those used for the corresponding Shared Uplink Set and the network connections can only be selected from a single Shared Uplink Set. When this option is not checked server network connections can be selected from any VC network and the external VLAN ID mappings can be manually edited. In the example of the screenshots I decided to check it.&lt;/p&gt;

&lt;p&gt;Below are another two optional settings for link speed control when using mapped VLAN tags. These settings are:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Set a Custom value for Preferred Link Connection Speed. This value applies to server profiles with a Multiple Networks connection defined and the &lt;strong&gt;Port Speed Setting&lt;/strong&gt; set to &lt;strong&gt;Preferred&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Set a Custom value for Maximum Link Connection Speed. This value limits the maximum port speed for multi-network connections when a Custom port speed is specified.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In our example we’re not going to check neither of them . Click next to move into the Define Network Connection screen.&lt;/p&gt;

&lt;p&gt;Choose the network type you want to define and click next. I choose &lt;strong&gt;Connection with uplink(s) dedicated to a single network&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/network_wizard_4.png&quot;&gt;&lt;img src=&quot;/images/network_wizard_4.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The &lt;strong&gt;Define Single Network&lt;/strong&gt; window shows up. First define the network name (prod_net_01 in my example). There are three configurable values.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Smart Link&lt;/strong&gt; - With this option enabled Virtual Connect will drop the Ethernet link on every server connected to that network if the link to the external switches is lost.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Private Network&lt;/strong&gt; - This option is intended to provide extra network security by isolating all server ports from each other within the VC Domain. All packets will be sent through the VC Domain and out the uplinks ports so the communication between the severs will go through an external L3 router that will redirect the traffic back to the Domain.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Enable VLAN Tunneling&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;/images/network_wizard_5.png&quot;&gt;&lt;img src=&quot;/images/network_wizard_5.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Click the &lt;strong&gt;Advanced&lt;/strong&gt; button to configure &lt;strong&gt;Advanced Network Settings&lt;/strong&gt;. Set the network link speeds that best suites your configuration.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/network_wizard_6.png&quot;&gt;&lt;img src=&quot;/images/network_wizard_6.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Again from the &lt;strong&gt;Define Single Network&lt;/strong&gt; page we are going to assign a port to our network. Click on &lt;strong&gt;Add Port&lt;/strong&gt; and select an uplink port.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/network_wizard_7.png&quot;&gt;&lt;img src=&quot;/assets/network_wizard_7.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Set the &lt;em&gt;Connection Mode&lt;/em&gt; to &lt;em&gt;Auto&lt;/em&gt; if the ports are trunked and to &lt;em&gt;*Failve&lt;/em&gt;r* if not.&lt;/p&gt;

&lt;p&gt;Click Apply and move onto the next screen. From this screen you can create as many additional networks as you need.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/network_wizard_8.png&quot;&gt;&lt;img src=&quot;/images/network_wizard_8.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Now we are going to create a network using VLAN tagging. Click &lt;strong&gt;Next&lt;/strong&gt; an move again into the &lt;strong&gt;Define Network Connection&lt;/strong&gt; page, select &lt;strong&gt;Connection with uplink(s) carrying multiple networks (using VLAN tagging)&lt;/strong&gt; and click &lt;em&gt;Next&lt;/em&gt;. The &lt;strong&gt;Define Shared Uplink Port Set&lt;/strong&gt; page will be displayed.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/network_wizard_9.png&quot;&gt;&lt;img src=&quot;/images/network_wizard_9.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A shared uplink is the way Virtual Connect has to identify which uplinks carry multiple networks over the same cable. On shared uplinks the VLAN tags are added when packets leave the enclosure and added when leave. The external switch and the Virtual Connect Manager must be configured with the same VLAN tag ID for each network  on the shared uplinks. The uplinks enables multiple ports to be added in order to support port aggregation and link failover, with a consistent set of VLAN tags. Virtual Connect has no restriction on which VLAN IDs can be used so the VLANs already used in the external infrastructure can be used here.&lt;/p&gt;

&lt;p&gt;Since the VLAN tags are removed or added as soon as the packet enter or leave &lt;strong&gt;VC Ethernet Module&lt;/strong&gt; shared uplink they have no relevance after the packet enter the enclosure. By identifying an associated network as the native VLAN will cause all untagged incoming packets to be placed onto this network, just one network can be designated as the native
VLAN.&lt;/p&gt;

&lt;p&gt;To finish the network creation assign a name (up to 64 characters with no spaces), add a port using the drop-down menu like in the single network process described above and add the networks you want to associate to the uplink. Finally click &lt;strong&gt;Apply&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/network_wizard_10.png&quot;&gt;&lt;img src=&quot;/images/network_wizard_10.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In the final screen you will see now the three networks associated to a &lt;strong&gt;Shared Uplink Set&lt;/strong&gt;. You can check this also from the &lt;strong&gt;Virtual Connect Manager&lt;/strong&gt; page in the &lt;strong&gt;Ethernet Networks&lt;/strong&gt; area.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/network_wizard_11.png&quot;&gt;&lt;img src=&quot;/images/network_wizard_11.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And we are done with the &lt;strong&gt;Network Setup&lt;/strong&gt;, in the next post I will show the storage part. As always any feedback would be welcome.&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/hp/networking/virtualization/hp-virtual-connect-domain-setup-part-2-network-setup/&quot;&gt;HP Virtual Connect Domain Setup - Part 2: Network Setup&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on December 21, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[HP Virtual Connect Domain Setup - Part 1: Domain Setup Wizard]]></title>
  <link rel="alternate" type="text/html" href="/hp/networking/virtualization/hp-virtual-connect-domain-setup-part-1-domain-setup-wizard/" />
  <id>/hp/networking/virtualization/hp-virtual-connect-domain-setup-part-1-domain-setup-wizard</id>
  <published>2010-12-20T14:53:00+01:00</published>
  <updated>2010-12-20T14:53:00+01:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;A friend asked me last week if I could produce a document for him explaining the initial basic setup of Virtual Connect, I decided that instead of  that it would be better and more helpful to write in a series of blog posts, here it is the first of them for you to enjoy.&lt;/p&gt;

&lt;p&gt;Virtual Connect is a technology developed by Hewlett-Packard for the HP BladeSystem c-Class enclosures. Provides server-edge and I/O virtualization in order to simplify the setup, maintenance and administration of server connections. It comprises a set of interconnect modules, both Ethernet and Fibre Channel, and a software known as &lt;strong&gt;Virtual Connect Manager&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Virtual Connect Manager, or VCM, is the single point administration interface for Virtual Connect. Under the hoods VCM is a software embedded into the VC Ethernet module, it can be accessed through a web-based interface or command line either with a serial connection to the Ethernet module or through a SSH connection to the module.&lt;/p&gt;

&lt;p&gt;From the VCM only a single domain, with up to four enclosures, can be managed.&lt;/p&gt;

&lt;p&gt;For large-scale infrastructures there is a more scalable version of VCM known as &lt;strong&gt;Virtual Connect Enterprise Manager&lt;/strong&gt;, or VCEM. Unlike VCM, Virtual Connect Enterprise Manager is not embedded into the VC-Enet module, is a separate software that must be installed in another server. VCEM extends the VC management capabilities up to 250 domains and hundreds of blade servers.&lt;/p&gt;

&lt;p&gt;Current series of articles will focus only on the Virtual Connect Manager GUI. Please take into account that I’m using &lt;strong&gt;Virtual Connect 3.10&lt;/strong&gt; version in the whole series and there some differences with the VC 2.x revisions.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/vcm_login.png&quot;&gt;&lt;img src=&quot;/images/vcm_login.png&quot; alt=&quot;&quot; title=&quot;VCM login page&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When you login into the VCM for the first time a series of wizards will show up to help you with the initial setup of the domain. This article will cover the first of those wizards, the &lt;strong&gt;Domain Setup Wizard&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/domain_wizard_1.png&quot;&gt;&lt;img src=&quot;/images/domain_wizard_1.png&quot; alt=&quot;&quot; title=&quot;Wizard Domain first screen&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This wizard will allow you to:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Import enclosure configuration and communication settings&lt;/li&gt;
  &lt;li&gt;Name the domain&lt;/li&gt;
  &lt;li&gt;Set the IP address of the Virtual Connect Manager&lt;/li&gt;
  &lt;li&gt;Set up the local user accounts and its permissions and privileges&lt;/li&gt;
  &lt;li&gt;Confirm that the stacking links provide connectivity and redundancy&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;After the informative screen the first step will display. Here you have to provide the enclosure Onboard Administrator IP address and credentials, these credentials must have administrative level. Click next when finish.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/domain_wizard_2.png&quot;&gt;&lt;img src=&quot;/images/domain_wizard_2.png&quot; alt=&quot;&quot; title=&quot;Domain wizard screen&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Now VC Domain Wizard will import all the servers and VC interconnect modules within the enclosure.&lt;/p&gt;

&lt;p&gt;In the next screen select the enclosure to import and click next.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/domain_wizard_3.png&quot;&gt;&lt;img src=&quot;/images/domain_wizard_3.png&quot; alt=&quot;&quot; title=&quot;Domain Wizard&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A pop-up will show up to inform that the networking of all the blades within the enclosure will be disabled until VC Networking is properly configured. of course it will ask for confirmation.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/domain_wizard_4.png&quot;&gt;&lt;img src=&quot;/images/domain_wizard_4.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;After finishing the import the wizard will go the &lt;strong&gt;General Settings&lt;/strong&gt; part. The Domain Setup Wizard automatically assigns a domain name based on the enclosure name, you can change the name when running the setup wizard or at any time later from the &lt;strong&gt;Domain Settings&lt;/strong&gt; screen. The Virtual Connect domain name should be unique and can be up to 31 characters without spaces or special characters.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/domain_wizard_5.png&quot;&gt;&lt;img src=&quot;/images/domain_wizard_5.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Next step is to configure the local user accounts.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/2010/image/domain_wizard_6.png&quot;&gt;&lt;img src=&quot;/images/domain_wizard_6.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;By default the only local account is Administrator, this account cannot be deleted nor have domain privileges removed. You can also add up to 32 accounts with a combination of up to four levels of access. The available levels are:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Virtual Connect Domain&lt;/li&gt;
  &lt;li&gt;Server&lt;/li&gt;
  &lt;li&gt;Networking&lt;/li&gt;
  &lt;li&gt;Storage&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;There is also an &lt;strong&gt;Advanced&lt;/strong&gt; area for each account where you can set &lt;strong&gt;Strong Passwords&lt;/strong&gt; requirement and the minimum password length.&lt;/p&gt;

&lt;p&gt;With this the &lt;strong&gt;Domain Setup Wizard&lt;/strong&gt; is done. In the next article I will write about the network setup of the enclosure using the &lt;strong&gt;Network Setup Wizard&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Juanma&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/hp/networking/virtualization/hp-virtual-connect-domain-setup-part-1-domain-setup-wizard/&quot;&gt;HP Virtual Connect Domain Setup - Part 1: Domain Setup Wizard&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on December 20, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[Get the iSCSI iqn of an ESX(i) using vSphere PowerCLI]]></title>
  <link rel="alternate" type="text/html" href="/sysadmin/virtualization/vmware/get-the-iscsi-iqn-using-vsphere-powercli/" />
  <id>/sysadmin/virtualization/vmware/get-the-iscsi-iqn-using-vsphere-powercli</id>
  <published>2010-12-14T15:02:05+01:00</published>
  <updated>2010-12-14T15:02:05+01:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;In yesterday’s &lt;a href=&quot;/sysadmin/virtualization/vmware/get-the-iscsi-iqn-of-an-esxi-using-the-cli/&quot; title=&quot;Get the iSCSI iqn of an ESX(i) using the CLI&quot;&gt;post&lt;/a&gt; I showed how to get the iSCSI iqn from an ESX(i) server using vSphere CLI from the vMA and from the root shell of ESX itself. Today it’s turn to use PowerCLI to perform the same task.&lt;/p&gt;

&lt;p&gt;The approach to be taken is very similar to the one we used to manage the &lt;a href=&quot;/storage/sysadmin/virtualization/vmware/managing-the-multipathing-configuration-with-vsphere-powercli/&quot; title=&quot;Managing the multipathing configuration with vSphere PowerCLI&quot;&gt;multipathing configuration&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[vSphere PowerCLI] C:\&amp;gt; $h = Get-VMhost esx02.mlab.local
[vSphere PowerCLI] C:\&amp;gt; $hostview = Get-View $h.id
[vSphere PowerCLI] C:\&amp;gt; $storage = Get-View $hostview.ConfigManager.StorageSystem
[vSphere PowerCLI] C:\&amp;gt;
[vSphere PowerCLI] C:\&amp;gt; $storage.StorageDeviceInfo

HostBusAdapter              : {key-vim.host.ParallelScsiHba-vmhba0, key-vim.host.BlockHba-vmhba1, key-vim.host.BlockHba-vmhba32, key-vim.host.InternetScsiHba-vmhba33}
ScsiLun                     : {key-vim.host.ScsiLun-0005000000766d68626133323a303a30, key-vim.host.ScsiDisk-0000000000766d686261303a303a30}
ScsiTopology                : VMware.Vim.HostScsiTopology
MultipathInfo               : VMware.Vim.HostMultipathInfo
PlugStoreTopology           : VMware.Vim.HostPlugStoreTopology
SoftwareInternetScsiEnabled : True
DynamicType                 :
DynamicProperty             :

[vSphere PowerCLI] C:\&amp;gt;
[vSphere PowerCLI] C:\&amp;gt; $storage.StorageDeviceInfo.HostBusAdapter | select IScsiName

IScsiName                                                                                                                                                               
---------                                                                                                                                                                

iqn.1998-01.com.vmware:esx02-42b0f47e                                                                                                                                    

[vSphere PowerCLI] C:\&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Juanma,&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/sysadmin/virtualization/vmware/get-the-iscsi-iqn-using-vsphere-powercli/&quot;&gt;Get the iSCSI iqn of an ESX(i) using vSphere PowerCLI&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on December 14, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[Get the iSCSI iqn of an ESX(i) using vSphere CLI]]></title>
  <link rel="alternate" type="text/html" href="/sysadmin/virtualization/vmware/get-the-iscsi-iqn-of-an-esxi-using-the-cli/" />
  <id>/sysadmin/virtualization/vmware/get-the-iscsi-iqn-of-an-esxi-using-the-cli</id>
  <published>2010-12-13T12:57:47+01:00</published>
  <updated>2010-12-13T12:57:47+01:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;When you are trying to configure iSCSI of and ESX(i) server from the command line is clear that at some point you are going to need the iqn. Of course you can  use the vSphere Client to get the iqn but the Unix Geek inside me really wants to do it from the shell.&lt;/p&gt;

&lt;p&gt;After a small research through the &lt;a href=&quot;http://www.vmware.com/support/developer/vcli/&quot;&gt;vSphere CLI&lt;/a&gt; documentation and several blogs I found this &lt;a href=&quot;http://www.2vcps.com/2009/11/27/get-iscsi-iqn-from-the-esx-command-line/&quot;&gt;post&lt;/a&gt; by Jon Owings (&lt;a href=&quot;http://twitter.com/2vcps&quot;&gt;@2vcps&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;First list the SCSI devices available in the system to get the iSCSI hba.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@esx02 ~]# esxcfg-scsidevs -a
vmhba0  mptspi            link-n/a  pscsi.vmhba0                            (0:0:16.0) LSI Logic / Symbios Logic LSI Logic Parallel SCSI Controller
vmhba1  ata_piix          link-n/a  ide.vmhba1                              (0:0:7.1) Intel Corporation Virtual Machine Chipset
vmhba32 ata_piix          link-n/a  ide.vmhba32                             (0:0:7.1) Intel Corporation Virtual Machine Chipset
vmhba33 iscsi_vmk         online    iscsi.vmhba33                           iSCSI Software Adapter         
[root@esx02 ~]#&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;After that Jon uses the command &lt;code&gt;vmkiscsi-tool&lt;/code&gt; to get the iqn.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@esx02 ~]# vmkiscsi-tool -I -l vmhba33
iSCSI Node Name: iqn.1998-01.com.vmware:esx02-42b0f47e
[root@esx02 ~]#&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Beauty, isn’t it? But I found one glitch. This method is done from the ESX root shell but how do I get the iqn from the vMA? Some of my hosts are ESXi and even for the ESX I use the vMA to perform my everyday administration tasks.&lt;/p&gt;

&lt;p&gt;There is no &lt;code&gt;vmkiscsi-tool&lt;/code&gt; command in the vMA, instead we are going to use the &lt;code&gt;vicfg-iscsi&lt;/code&gt; or the &lt;code&gt;vicfg-scsidevs&lt;/code&gt; command.&lt;/p&gt;

&lt;p&gt;With &lt;code&gt;vicfg-scsidevs&lt;/code&gt; we can obtain the iqn listed in the &lt;code&gt;UID&lt;/code&gt; column.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[vi-admin@vma ~][esx02.mlab.local]$ vicfg-scsidevs -a             
Adapter_ID  Driver      UID                                     PCI      Vendor &amp;amp; Model
vmhba0      mptspi      pscsi.vmhba0                            (0:16.0) LSI Logic Parallel SCSI Controller
vmhba1      ata_piix    unknown.vmhba1                          (0:7.1)  Virtual Machine Chipset
vmhba32     ata_piix    ide.vmhba32                             (0:7.1)  Virtual Machine Chipset
vmhba33     iscsi_vmk   iqn.1998-01.com.vmware:esx02-42b0f47e   ()       iSCSI Software Adapter
[vi-admin@vma ~][esx02.mlab.local]$&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And with &lt;code&gt;vicfg-iscsi&lt;/code&gt; we can get the iqn providing the &lt;code&gt;vmhba&lt;/code&gt; device.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[vi-admin@vma ~][esx02.mlab.local]$ vicfg-iscsi --iscsiname --list vmhba33
iSCSI Node Name   : iqn.1998-01.com.vmware:esx02-42b0f47e
iSCSI Node Alias  :
[vi-admin@vma ~][esx02.mlab.local]$&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The next logical step is to use PowerCLI to retrieve the iqn, but I’ll leave that for a future post.&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/sysadmin/virtualization/vmware/get-the-iscsi-iqn-of-an-esxi-using-the-cli/&quot;&gt;Get the iSCSI iqn of an ESX(i) using vSphere CLI&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on December 13, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[EMC Symmetrix Timefinder survival guide]]></title>
  <link rel="alternate" type="text/html" href="/emc/storage/emc-symmetrix-timefinder-survival-guide/" />
  <id>/emc/storage/emc-symmetrix-timefinder-survival-guide</id>
  <published>2010-12-10T11:15:51+01:00</published>
  <updated>2010-12-10T11:15:51+01:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;During a previous project I had the opportunity to work very closely with the &lt;strong&gt;EMC&lt;/strong&gt; people and Symmetrix arrays, in fact I got a couple of very good friends from that project. At the time I created a bunch of text files for my self  reference about EMC SRDF and Timefinder technologies.&lt;/p&gt;

&lt;p&gt;Today I decided to review that files, give them some order, well sort of, and put them here as a survival guide/quick reference in the hope that will be of help to any of you. The first of this guides will be about &lt;strong&gt;EMC Symmetrix Timefinder.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;I don’t have sample output for every command, been more than a year since the last time I work with Timefinder, to complement my own samples I got several outputs from the Timefinder manuals.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;This is not a complete Timefinder usage guide&lt;/strong&gt;, just my personal notes taken from my direct experience with product.&lt;/p&gt;

&lt;h3 id=&quot;timefinder-basics&quot;&gt;Timefinder Basics&lt;/h3&gt;

&lt;p&gt;EMC Timefinder is a replication solution that creates full volume copies. For the full-HP guys out there this is very similar to the XP or EVA Business Copy product.&lt;/p&gt;

&lt;p&gt;There are two basic types of replication:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;TimefinderClone - Creates point-in-time copies.&lt;/li&gt;
  &lt;li&gt;Timefinder/Snap - Creates pointer-based replicas, snapshots, only the changed data is written.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;There are several optional components.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Timefinder/Mirror.&lt;/li&gt;
  &lt;li&gt;Timefinder/CG (Consistency Groups)&lt;/li&gt;
  &lt;li&gt;Timefinder/EIM (Exchange Integration Modules)&lt;/li&gt;
  &lt;li&gt;Timefinder/SIM (SQL Integration Modules)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Timefinder allows to retain multiple copies at different checkpoints for lowered RPO and RTO.&lt;/p&gt;

&lt;h3 id=&quot;symcli-basics&quot;&gt;Symcli basics&lt;/h3&gt;

&lt;p&gt;Following is a list of the most basic &lt;code&gt;symcli&lt;/code&gt; commands necessary to get your way around when you perform any Symmetrix task, including Timefinder.&lt;/p&gt;

&lt;h4 id=&quot;get-the-list-of-the-symmetrix-devices&quot;&gt;Get the list of the Symmetrix devices&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symdev list
Symmetrix ID: 00029xxxxxxx
        Device Name           Directors                  Device
--------------------------- ------------- -------------------------------------
                                                                           Cap
Sym  Physical               SA :P DA :IT  Config        Attribute Sts      (MB)
--------------------------- ------------- -------------------------------------
0000 Not Visible            ???:? 01A:C0  BCV           Asst&amp;#39;d    RW       8632
0001 Not Visible            ???:? 16C:D0  BCV           Asst&amp;#39;d    RW       8632
0002 Not Visible            ???:? 01B:D0  BCV           Asst&amp;#39;d    RW       8632
0003 Not Visible            ???:? 16D:C0  BCV           Asst&amp;#39;d    RW       8632
…………………………………………………………………………………………………………………………………………………………………………………………………………………
0048 Not Visible            ???:? ???:??  VDEV          N/Grp&amp;#39;d   RW       8632
0049 Not Visible            ???:? ???:??  VDEV          N/Grp&amp;#39;d   RW       8632
004A Not Visible            ???:? ???:??  VDEV          N/Grp&amp;#39;d   RW       8632
004B Not Visible            ???:? ???:??  VDEV          N/Grp&amp;#39;d   NR       8632
004C Not Visible            ???:? ???:??  VDEV          N/Grp&amp;#39;d   NR       8632
004D Not Visible            ???:? ???:??  VDEV          N/Grp&amp;#39;d   NR       8632
004E Not Visible            ???:? ???:??  VDEV          N/Grp&amp;#39;d   NR       8632
004F Not Visible            ???:? ???:??  VDEV          N/Grp&amp;#39;d   NR       8632
0050 Not Visible            ???:? ???:??  VDEV          N/Grp&amp;#39;d   NR       8632
0051 Not Visible            ???:? ???:??  VDEV          N/Grp&amp;#39;d   NR       8632
0052 Not Visible            ???:? 16B:D1  2-Way Mir     N/A (SV)  RW       8632
0053 Not Visible            ???:? 01C:C0  2-Way Mir     N/A (SV)  RW       8632
0054 Not Visible            ???:? 16B:C0  2-Way Mir     N/A (SV)  RW       8632
…………………………………………………………………………………………………………………………………………………………………………………………………………………&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;list-all-available-devices-from-a-device-group&quot;&gt;List all available devices from a device group&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symld -g dg_oradev_01 list&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;list-host-physical-devices&quot;&gt;List host physical devices&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# sympd list&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;list-the-disk-groups&quot;&gt;List the disk groups:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# /usr/symcli/bin/symdg list

                       D E V I C E      G R O U P S

                                                          Number of
 Name               Type     Valid  Symmetrix ID  Devs   GKs  BCVs  VDEVs

 dg_oracle_prod1    REGULAR  Yes    00029xxxxxxx    26     0    26      0
 dg_oracle_prod2    REGULAR  Yes    00029xxxxxxx    21     0    21      0
 dg_rac_01          RDF1     Yes    00029xxxxxxx    23     0    23      0
 dg_clvx_01         RDF1     Yes    00029xxxxxxx     5     0     5      0
 dg_oradev_01       REGULAR  Yes    00029xxxxxxx     3     0     0      0
 dg_timetest_02     RDF1     Yes    00029xxxxxxx    16     0    16      0
 grupo1             RDF1     Yes    00029xxxxxxx    22     0     0      0

root:/#&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;add-devices-to-a-disk-group&quot;&gt;Add devices to a disk group&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;Add physical devices&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symld -g dg_oradev_01 add pd /dev/dsk/c2t4d12&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Add Symmetrix devices&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symld -g dg_oradev_01 add 006E&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;get-diskgroup-detailed-info&quot;&gt;Get diskgroup detailed info.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# /usr/symcli/bin/symdg show dg_prod_01

Group Name:  dg_prod_01

    Group Type                                   : RDF1     (RDFA)
    Device Group in GNS                          : No
    Valid                                        : Yes
    Symmetrix ID                                 : 00029xxxxxxx
    Group Creation Time                          : Mon Nov 29 18:49:29 2007
    Vendor ID                                    : EMC Corp
    Application ID                               : ECC

    Number of STD Devices in Group               :    2
    Number of Associated GK&amp;#39;s                    :    0
    Number of Locally-associated BCV&amp;#39;s           :    2
    Number of Locally-associated VDEV&amp;#39;s          :    0
    Number of Remotely-associated VDEV&amp;#39;s(STD RDF):    0
    Number of Remotely-associated BCV&amp;#39;s (STD RDF):    0
    Number of Remotely-associated BCV&amp;#39;s (BCV RDF):    0
    Number of Remotely-assoc&amp;#39;d RBCV&amp;#39;s (RBCV RDF) :    0

    Standard (STD) Devices (2):
        {
        --------------------------------------------------------------------
        Sym               Cap
        LdevName              PdevName                Dev  Att. Sts     (MB)
        --------------------------------------------------------------------
        DEV001                N/A                     01C8      RW      8714
        DEV002                N/A                     01C9      RW      8714
        }

    BCV Devices Locally-associated (2):
        {
        --------------------------------------------------------------------
        Sym               Cap
        LdevName              PdevName                Dev  Att. Sts     (MB)
        --------------------------------------------------------------------
        BCV001                N/A                     08A8      RW      8714
        BCV002                N/A                     08A9      RW      8714
        }

    Device Group RDF Information
        {
        RDF Type                               : R1
        RDF (RA) Group Number                  : 2               (01)

        Remote Symmetrix ID                    : 000287xxxxxx

        R2 Device Is Larger Than The R1 Device : False

        RDF Pair Configuration                 : Normal
        RDF STAR Mode                          : False

        RDF Mode                               : Synchronous
        RDF Adaptive Copy                      : Disabled
        RDF Adaptive Copy Write Pending State  : N/A
        RDF Adaptive Copy Skew (Tracks)        : 32767

        RDF Device Domino                      : Disabled

        RDF Link Configuration                 : Fibre
        RDF Link Domino                        : Disabled
        Prevent Automatic RDF Link Recovery    : Disabled
        Prevent RAs Online Upon Power ON       : Enabled

        Device RDF Status                      : Ready           (RW)

        Device RA Status                       : Ready           (RW)
        Device Link Status                     : Ready           (RW)

        Device Suspend State                   : N/A
        Device Consistency State               : Disabled
        RDF R2 Not Ready If Invalid            : Disabled

        Device RDF State                       : Ready           (RW)
        Remote Device RDF State                : Write Disabled  (WD)

        RDF Pair State (  R1 &amp;lt;===&amp;gt; R2 )        : Synchronized

        Number of R1 Invalid Tracks            : 0
        Number of R2 Invalid Tracks            : 0

        RDFA Information:
            {
            Session Number                     : 1
            Cycle Number                       : 0
            Number of Devices in the Session   : 491
            Session Status                     : Inactive

            Session Consistency State          : N/A
            Minimum Cycle Time                 : 00:00:30
            Average Cycle Time                 : 00:00:00
            Duration of Last cycle             : 00:00:00
            Session Priority                   : 33

            Tracks not Committed to the R2 Side: 0
            Time that R2 is behind R1          : 00:00:00
            R1 Side Percent Cache In Use       :  0
            R2 Side Percent Cache In Use       :  0

            }
        }

root:/#&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&quot;timfinder-commands&quot;&gt;Timfinder commands&lt;/h3&gt;

&lt;h4 id=&quot;associate-bcvs-to-a-device-group-there-are-two-ways&quot;&gt;Associate BCVs to a device group. There are two ways:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symbcv -sid xxxx -g dg_oradev_01 associate dev 0001&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;establish-the-mirrors&quot;&gt;Establish the mirrors&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symmir -g dg_oradev_01 -full establish DEV001 BCV001&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;split-operations&quot;&gt;Split operations.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symmir -g dg_oradev_01 split&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There are several additional split modes and/or modifiers.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Instant&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symmir -g dg_oradev_01 split -instant&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Force&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symmir -g dg_oradev_01 split -force&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Differential&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symmir -g dg_oradev_01 split -differential&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Reverse&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root/# symmir -g dg_oradev_01 reverse split&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Reverse differential&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symmir -g dg_oradev_01 reverse split -differential&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;restore-the-bcv-mirrors&quot;&gt;Restore the BCV mirrors.&lt;/h4&gt;

&lt;p&gt;The restore operation will copy the data from the BCV to the Standard device.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Differential restore&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symmir -g dg_oradev_01 restore&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Full restore&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symmir -g dg_oradev_01 -full restore&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;reestablish-operations&quot;&gt;Reestablish operations.&lt;/h4&gt;

&lt;p&gt;It is very important to tell the difference between &lt;em&gt;Restore&lt;/em&gt; and &lt;em&gt;Reestablish&lt;/em&gt;. Reestablish will do a differential
update from the Standard device to the BCV device.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symmir -g dg_oradev_01 establish&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;get-the-list-of-bcv-devices&quot;&gt;Get the list of BCV devices&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symbcv list

Symmetrix ID: 00029xxxxxxx
              BCV Device                   Standard Device          Status
------------------------------------ --------------------------- ------------
                              Inv.                        Inv.
Physical         Sym RDF Att. Tracks Physical        Sym  Tracks BCV &amp;lt;=&amp;gt; STD
------------------------------------ --------------------------- ------------
Not Visible      0030    (M)       0 N/A             N/A       0 NeverEstab
Not Visible      0031    (m)       - N/A             N/A       - NeverEstab
……………………………………………………………………………………………………………………………………………………………………………………………………………
c4t1d0s2         0088              0 c4t0d0s2        0084      0 Split
c4t1d1s2         0089              0 c4t0d1s2        0085      0 Split
c4t1d2s2         008A              0 c4t0d2s2        0086      0 Split
c4t1d3s2         008B              0 c4t0d3s2        0087      0 Split&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;get-the-state-of-mirroring-of-the-device-pairs-within-a-device-group&quot;&gt;Get the state of mirroring of the device pairs within a device group&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# /usr/symcli/bin/symmir -g dg_oracle_prod_01 query

Device Group (DG) Name: dg_oracle_prod_01
DG&amp;#39;s Type             : RDF1
DG&amp;#39;s Symmetrix ID     : 00029xxxxxxx

     Standard Device                    BCV Device                  State
-------------------------- ------------------------------------- ------------
                    Inv.                                  Inv.
Logical        Sym  Tracks Logical              Sym       Tracks STD &amp;lt;=&amp;gt; BCV
-------------------------- ------------------------------------- ------------

DEV001         0184      0 BCV001               039C *         0 Split
DEV002         0186      0 BCV002               039E *         0 Split
DEV003         0187      0 BCV003               039F *         0 Split
DEV004         0188      0 BCV004               03A0 *         0 Split
DEV005         0189      0 BCV005               03A1 *         0 Split
DEV006         018E      0 BCV006               03A6 *         0 Split
DEV007         018F      0 BCV007               03A7 *         0 Split
DEV008         0190      0 BCV008               03A8 *         0 Split
DEV009         0191      0 BCV009               03A9 *         0 Split
DEV010         01C7      0 BCV010               08A7 *         0 Split
DEV011         01CD      0 BCV011               08AA *         0 Split

Total              -------                               -------
  Track(s)               0                                     0
  MB(s)                0.0                                   0.0

Legend:

(*): The paired BCV device is associated with this group.

root:/#&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;list-all-bcv-sessions-in-a-symmetrix-array&quot;&gt;List all BCV sessions in a Symmetrix array&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;root:/# symmir list -sid xxxx

Symmetrix ID: 00000000xxxx

  Standard Device       BCV Device              State
-------------------- ----------------------- --------------
           Invalid             Invalid   GBE
Sym        Tracks     Sym      Tracks         STD &amp;lt;=&amp;gt; BCV
-------------------- ----------------------- --------------
002B               0 0E0B            0   ... Synchronized
002E               0 0E00            0   ..X Synchronized
002E               0 0E0A            0   ... Synchronized
0032               0 0E0F            0   ... Split
00FF               0 00FD            0   ... Split
0DF5               0 0DA5            0   ..X Synchronized
0DF5               0 0DA4            0   ..X Synchronized
0F70               0 001B         3592   X.. SyncInProg
0F71               0 001C         4496   X.. SyncInProg
0F93               0 0DF9            0   ..X Split
1015               0 1069            0   X.. Synchronized

Total       --------          --------
  Tracks           0              8088
  MB(s)          0.0             505.5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And we are done. As I said this is not a full guide so please if there is anything that you don’t get please leave a comment and I will try to clarify. Also if any of you have additional tips or recipes for Timefinder please comment.&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/emc/storage/emc-symmetrix-timefinder-survival-guide/&quot;&gt;EMC Symmetrix Timefinder survival guide&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on December 10, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[1 year...]]></title>
  <link rel="alternate" type="text/html" href="/blog/personal/1-year/" />
  <id>/blog/personal/1-year</id>
  <published>2010-12-07T10:52:12+01:00</published>
  <updated>2010-12-07T10:52:12+01:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;I really can not believe it but a year has passed since my first &lt;a href=&quot;/blog/personal/hello-world/&quot; title=&quot;Hello world!&quot;&gt;“Hello World!”&lt;/a&gt; post.&lt;/p&gt;

&lt;p&gt;During this first year I received more than 25,000 visits, which to be sincere is far more than I expected. Below is a screenshot showing my top ten posts.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/top-ten.png&quot;&gt;&lt;img src=&quot;/images/top-ten.png&quot; alt=&quot;&quot; title=&quot;Top ten posts&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I want to thank all of you who have been following the blog. I also have a special thank to my dear friend &lt;strong&gt;Jean Mesquida&lt;/strong&gt; who have been giving me a lot of feedback about many of my blog posts. I enjoyed to write every post.&lt;/p&gt;

&lt;p&gt;I’m pretty sure the next year will be even better.&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/blog/personal/1-year/&quot;&gt;1 year...&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on December 07, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[HP P4000: Setup a two-node cluster]]></title>
  <link rel="alternate" type="text/html" href="/hp/storage/virtualization/vmware/hp-p4000-setup-a-two-node-cluster/" />
  <id>/hp/storage/virtualization/vmware/hp-p4000-setup-a-two-node-cluster</id>
  <published>2010-12-06T15:50:59+01:00</published>
  <updated>2010-12-06T15:50:59+01:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;This post will outline the necessary steps to create a standard (no-multisite) &lt;strong&gt;HP P4000&lt;/strong&gt; cluster with two nodes. Creating a two-node cluster is a very similar process as the one-node cluster described in my first &lt;a href=&quot;/storage/virtualization/first-hands-on-with-the-hp-lefthand-p4000-vsa/&quot;&gt;post&lt;/a&gt; about P4000 systems.&lt;/p&gt;

&lt;p&gt;The cluster is composed by:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;2 HP P4000 Virtual Storage Appliances&lt;/li&gt;
  &lt;li&gt;1 HP P4000 Failover Manager&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The &lt;strong&gt;Failover Manager&lt;/strong&gt;, or FOM, is a specialized version of the SAN/iQ software. It runs as a virtual appliance in VMware, thought the most common situation is to run it in a ESX/ESXi servers running it under VMware player or Server is also supported.&lt;/p&gt;

&lt;p&gt;The FOM integrates into a management group as a real manager and is intended only to provide quorum to the cluster, one of its main purposes is to provide quorum in Multi-site clusters. I decided to use it in this post to provide an example as real as possible.&lt;/p&gt;

&lt;p&gt;To setup this cluster I used virtual machines inside &lt;a href=&quot;http://www.vmware.com/products/workstation/index.html&quot;&gt;VMware Workstation&lt;/a&gt;, but the same design can also be created with physical servers and P4000 storage systems.&lt;/p&gt;

&lt;p&gt;From the &lt;strong&gt;Getting started&lt;/strong&gt; screen launch the clusters wizard.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/vjm-p4000.png&quot;&gt;&lt;img src=&quot;/images/vjm-p4000_thumb.png&quot; alt=&quot;&quot; title=&quot;P4000 Getting Started&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Select the two P4000 storage systems and enter the name of the Management Group&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/new_mgmt-group.png&quot;&gt;&lt;img src=&quot;/images/new_mgmt-group.png&quot; alt=&quot;&quot; title=&quot;New Management Group&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;During the group creation will ask to create a cluster, choose the two nodes as members of the cluster, will add the FOM later, and assign a name to the cluster.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/clusterlab01.png&quot;&gt;&lt;img src=&quot;/images/clusterlab01.png&quot; alt=&quot;&quot; title=&quot;Cluster&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Next assign a virtual IP address to the cluster.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/clusterlab01_02.png&quot;&gt;&lt;img src=&quot;/images/clusterlab01_02.png&quot; alt=&quot;&quot; title=&quot;Cluster VIP address&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Enter the administrative level credentials for the cluster.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/admin_user.png&quot;&gt;&lt;img src=&quot;/images/admin_user.png&quot; alt=&quot;&quot; title=&quot;Admin user creation&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Finally the wizard will ask if you want to create volumes in the cluster, I didn’t take that option and finished the cluster creation process. You can also add the volumes later as I described in one of my previous &lt;a href=&quot;/storage/sysadmin/virtualization/vmware/add-iscsi-volumes-from-hp-p4000-vsa-to-vmware-esxi4/&quot; title=&quot;Add iSCSI volumes from HP P4000 VSA to VMware ESXi4&quot;&gt;posts&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Now the that cluster is formed we are going to add the Failover Manager.&lt;/p&gt;

&lt;p&gt;It’s is important that the FOM requires the same configuration as any VSA as I depicted in my first post about the P4000 storage systems.&lt;/p&gt;

&lt;p&gt;In the Central Management Console right-click into the FOM and select &lt;strong&gt;Add to existing management group&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/fom_join.png&quot;&gt;&lt;img src=&quot;/images/fom_join.png&quot; alt=&quot;&quot; title=&quot;FOM join group&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Select the management group and click &lt;strong&gt;Add&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/fom_join2.png&quot;&gt;&lt;img src=&quot;/images/fom_join2.png&quot; alt=&quot;&quot; title=&quot;Select management group&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;With this operation the cluster configuration is done. If everything went well in the end you should have something like this.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/fom_join3.png&quot;&gt;&lt;img src=&quot;/images/fom_join3.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/hp/storage/virtualization/vmware/hp-p4000-setup-a-two-node-cluster/&quot;&gt;HP P4000: Setup a two-node cluster&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on December 06, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[Managing the multipathing configuration with vSphere PowerCLI]]></title>
  <link rel="alternate" type="text/html" href="/storage/sysadmin/virtualization/vmware/managing-the-multipathing-configuration-with-vsphere-powercli/" />
  <id>/storage/sysadmin/virtualization/vmware/managing-the-multipathing-configuration-with-vsphere-powercli</id>
  <published>2010-12-03T12:15:50+01:00</published>
  <updated>2010-12-03T12:15:50+01:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;Getting the multipathing policy using PowerCLI is a very simple an straight-forward process that can be done with a few commands.&lt;/p&gt;

&lt;p&gt;I test this procedure in the past with ESX/ESXi 3.5 and 4.0.&lt;/p&gt;

&lt;h4 id=&quot;get-the-multipahing-policy&quot;&gt;Get the multipahing policy&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[vSphere PowerCLI] C:\&amp;gt; $h = get-vmhost esx01.mlab.local
[vSphere PowerCLI] C:\&amp;gt; $hostview = get-view $h.id
[vSphere PowerCLI] C:\&amp;gt; $storage = get-view $hostView.ConfigManager.StorageSystem
[vSphere PowerCLI] C:\&amp;gt; $storage.StorageDeviceInfo.MultipathInfo.lun | select ID,Path,Policy

Id → → Path → → → → Policy
-- → → ---- → → → → ------
vmhba0:0:0 → {vmhba0:0:0} → → → VMware.Vim.HostMultipathInfoFixedLogicalUnitPolicy
vmhba1:1:0 → {vmhba1:1:0, vmhba1:0:0} → VMware.Vim.HostMultipathInfoFixedLogicalUnitPolicy
vmhba1:0:5 → {vmhba1:1:5, vmhba1:0:5} VMware.Vim.HostMultipathInfoFixedLogicalUnitPolicy
vmhba1:0:1 → {vmhba1:1:1, vmhba1:0:1} → VMware.Vim.HostMultipathInfoFixedLogicalUnitPolicy
vmhba1:0:12 → {vmhba1:1:12, vmhba1:0:12} → VMware.Vim.HostMultipathInfoFixedLogicalUnitPolicy&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;change-the-policy-from-fixed-to-round-robin&quot;&gt;Change the policy from fixed to round-robin&lt;/h4&gt;

&lt;p&gt;We are going to change the policy for the LUN 12.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[vSphere PowerCLI] C:\&amp;gt; $lunId = &amp;quot;vmhba1:0:12&amp;quot;
[vSphere PowerCLI] C:\&amp;gt; $storagepolicy = new-object VMware.Vim.HostMultipathInfoLogicalUnitPolicy
[vSphere PowerCLI] C:\&amp;gt; $storagepolicy.policy = &amp;quot;rr&amp;quot;
[vSphere PowerCLI] C:\&amp;gt; $storageSystem.SetMultipathLunPolicy($lunId, $policy)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;finally-check-the-new-configuration&quot;&gt;Finally check the new configuration&lt;/h4&gt;

&lt;p&gt;If you look closely at the last line will see that the value has change from &lt;code&gt;VMware.Vim.HostMultipathInfoFixedLogicalUnitPolicy&lt;/code&gt; to &lt;code&gt;VMware.Vim.HostMultipathInfoLogicalUnitPolicy&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[vSphere PowerCLI] C:\&amp;gt; $h = get-vmhost &amp;quot;ESXIPAddress&amp;quot;
[vSphere PowerCLI] C:\&amp;gt; $hostview = get-view $h.id
[vSphere PowerCLI] C:\&amp;gt; $storage = get-view $hostView.ConfigManager.StorageSystem
[vSphere PowerCLI] C:\&amp;gt; $storage.StorageDeviceInfo.MultipathInfo.lun | select ID,Path,Policy

Id → → Path → → → → Policy
-- → → ---- → → → → ------
vmhba0:0:0 → {vmhba0:0:0} → → → VMware.Vim.HostMultipathInfoFixedLogicalUnitPolicy
vmhba1:1:0 → {vmhba1:1:0, vmhba1:0:0} → VMware.Vim.HostMultipathInfoFixedLogicalUnitPolicy
vmhba1:0:5 → {vmhba1:1:5, vmhba1:0:5} VMware.Vim.HostMultipathInfoFixedLogicalUnitPolicy
vmhba1:0:1 → {vmhba1:1:1, vmhba1:0:1} → VMware.Vim.HostMultipathInfoFixedLogicalUnitPolicy
vmhba1:0:12 → {vmhba1:1:12, vmhba1:0:12} → VMware.Vim.HostMultipathInfoLogicalUnitPolicy&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/storage/sysadmin/virtualization/vmware/managing-the-multipathing-configuration-with-vsphere-powercli/&quot;&gt;Managing the multipathing configuration with vSphere PowerCLI&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on December 03, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[Add a new NFS datastore via PowerCLI and vSphere CLI from vMA]]></title>
  <link rel="alternate" type="text/html" href="/sysadmin/virtualization/vmware/add-a-new-nfs-datastore-via-powercli-and-vma/" />
  <id>/sysadmin/virtualization/vmware/add-a-new-nfs-datastore-via-powercli-and-vma</id>
  <published>2010-12-01T17:22:13+01:00</published>
  <updated>2010-12-01T17:22:13+01:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;As a small follow-up to yesterday’s post about &lt;a href=&quot;/storage/virtualization/vmware/configure-nfs-shares-in-openfiler-for-your-vsphere-homelab/&quot; title=&quot;Configure NFS shares in Openfiler for your vSphere homelab&quot;&gt;NFS shares with Openfiler&lt;/a&gt; in the following article I will show how to add a new datastore to an ESX server using the vMA and PowerCLI.&lt;/p&gt;

&lt;h3 id=&quot;from-vma&quot;&gt;From vMA&lt;/h3&gt;

&lt;p&gt;From the vMA shell we are going to use the command &lt;code&gt;vicfg-nas&lt;/code&gt;. To clarify things a bit for the newcomers, &lt;code&gt;vicfg-nas&lt;/code&gt; and &lt;code&gt;esxcfg-nas&lt;/code&gt; are the same command, in fact &lt;code&gt;esxcfg-nas&lt;/code&gt; is no more than a link to the first.&lt;/p&gt;

&lt;p&gt;The option to create a new datastore is -a and additionally the address/hostname of the NFS servers, the share and a label for the new datastore must be provided.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[vi-admin@vma ~][esx01.mlab.local]$ vicfg-nas -l
No NAS datastore found
[vi-admin@vma ~][esx01.mlab.local]$ vicfg-nas -a -o openfiler.mlab.local -s /mnt/vg_nfs/lv_nfs01/nfs_datastore1 nfs_datastore1
Connecting to NAS volume: nfs_datastore1
nfs_datastore1 created and connected.
[vi-admin@vma ~][esx01.mlab.local]$&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When the operation is done you can check the new datastore with &lt;code&gt;vicfg-nas -l&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[vi-admin@vma ~][esx01.mlab.local]$ vicfg-nas -l
nfs_datastore1 is /mnt/vg_nfs/lv_nfs01/nfs_datastore1 from openfiler.mlab.local mounted
[vi-admin@vma ~][esx01.mlab.local]$&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&quot;powercli&quot;&gt;PowerCLI&lt;/h3&gt;

&lt;p&gt;In the second part of the post we are going to use &lt;strong&gt;vSphere PowerCLI&lt;/strong&gt;, which as you already know is a PowerShell module to manage vSphere/VI3 infrastructure. I will write more about PowerCLI in the since I’m very fond with it.&lt;/p&gt;

&lt;p&gt;The cmdlet to create the new NFS datastore is &lt;code&gt;New-Datastore&lt;/code&gt; and you must provide the ESX host, the NFS server, the path of the share and a name for the datastore. Then you can check that the new datastore has been properly added with &lt;code&gt;Get-Datastore&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/2010/12/new-datastore.png&quot;&gt;&lt;img src=&quot;/images/new-datastore.png&quot; alt=&quot;&quot; title=&quot;New-DataStore&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/sysadmin/virtualization/vmware/add-a-new-nfs-datastore-via-powercli-and-vma/&quot;&gt;Add a new NFS datastore via PowerCLI and vSphere CLI from vMA&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on December 01, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[Remove an inactive NFS datastore using vSphere CLI from vMA]]></title>
  <link rel="alternate" type="text/html" href="/sysadmin/virtualization/vmware/remove-an-inactive-nfs-datastore-from-the-vma/" />
  <id>/sysadmin/virtualization/vmware/remove-an-inactive-nfs-datastore-from-the-vma</id>
  <published>2010-12-01T13:57:30+01:00</published>
  <updated>2010-12-01T13:57:30+01:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;This post is mostly for self-reference but may be someone would find it useful. Last night I decided to change the IP address of one of the Openfiler instances in my homelab and instead of previously removing the NFS shares from the ESX servers I simply made the changes.&lt;/p&gt;

&lt;p&gt;After a restart of the network services in the Openfiler server to commit the changes I found that the ESX servers saw the datastore as inactive.&lt;/p&gt;

&lt;p&gt;First I tried to remove it from the vSphere Client and I received the following error message:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/inactive_datastore.png&quot;&gt;&lt;img src=&quot;/images/inactive_datastore.png&quot; alt=&quot;&quot; title=&quot;Inactive datastore&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I quickly switched to an SSH session in the vMA to check the state of the datastore, it appeared as &lt;code&gt;not mounted&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[vi-admin@vma /][esx01.mlab.local]$ esxcfg-nas -l
nfs_datastore1 is /mnt/vg_nfs/lv_nfs01/nfs_datastore1 from openfiler.mlab.local not mounted
[vi-admin@vma /][esx01.mlab.local]$&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;At this point I used &lt;code&gt;esxcfg-nas&lt;/code&gt; command to remove the datastore.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[vi-admin@vma /][esx01.mlab.local]$ esxcfg-nas -d nfs_datastore1
NAS volume nfs_datastore1 deleted.
[vi-admin@vma /][esx01.mlab.local]$ esxcfg-nas -l
No NAS datastore found
[vi-admin@vma /][esx01.mlab.local]$&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Very easy, isn’t it? Oh by the way this just confirm one of my personal beliefs &lt;em&gt;Where there is shell, there is a way&lt;/em&gt; ;-)&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/sysadmin/virtualization/vmware/remove-an-inactive-nfs-datastore-from-the-vma/&quot;&gt;Remove an inactive NFS datastore using vSphere CLI from vMA&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on December 01, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[Configure NFS shares in Openfiler for your vSphere homelab]]></title>
  <link rel="alternate" type="text/html" href="/storage/virtualization/vmware/configure-nfs-shares-in-openfiler-for-your-vsphere-homelab/" />
  <id>/storage/virtualization/vmware/configure-nfs-shares-in-openfiler-for-your-vsphere-homelab</id>
  <published>2010-11-30T17:01:42+01:00</published>
  <updated>2010-11-30T17:01:42+01:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;&lt;a href=&quot;http://jreypo.files.wordpress.com/2010/11/openfiler_logo_71.png&quot;&gt;&lt;img src=&quot;/images/openfiler_logo_71.png&quot; alt=&quot;&quot; title=&quot;Openfiler&quot; /&gt;&lt;/a&gt;Even if you have access to the enterprise-class storage appliances, like the
&lt;a href=&quot;http://h18006.www1.hp.com/products/storage/software/vsa/index.html&quot; title=&quot;HP P4000 VSA&quot;&gt;HP P4000 VSA&lt;/a&gt; or the &lt;a href=&quot;http://nickapedia.com/2010/10/04/play-it-again-sam-celerra-uber-v3-2/&quot; title=&quot;EMC Celerra UBER VSA&quot;&gt;EMC Celerra VSA&lt;/a&gt;, an &lt;a href=&quot;http://www.openfiler.com&quot; title=&quot;OpenFiler&quot;&gt;Openfiler&lt;/a&gt; storage appliance can be a great asset to your homelab. Specially if you, like myself, run an &lt;em&gt;all virtual&lt;/em&gt; homelab within VMware Workstation, since Openfiler is by far less resource hunger than its enterprise counterparts.&lt;/p&gt;

&lt;p&gt;Simon Seagrave (&lt;a href=&quot;http://twitter.com/#!/Kiwi_Si&quot;&gt;@Kiwi_Si&lt;/a&gt;) from &lt;a href=&quot;http://www.techhead.co.uk&quot;&gt;TechHead.co.uk&lt;/a&gt; wrote an &lt;a href=&quot;http://www.techhead.co.uk/how-to-configure-openfiler-v23-iscsi-storage-for-use-with-vmware-esx&quot;&gt;excellent article&lt;/a&gt; explaining how to add iSCSI LUNs from an Openfiler instance to your ESX/ESXi servers, if iSCSI is your “thing” you should check it.&lt;/p&gt;

&lt;p&gt;In this article I’ll explain how-to configure a NFS share in Openfiler and then add it as a datastore to your vSphere servers. I’ll take for granted that you already have an Openfiler server up and running.&lt;/p&gt;

&lt;h3 id=&quot;step-1---enable-nfs-service&quot;&gt;Step 1 - Enable NFS service&lt;/h3&gt;

&lt;p&gt;As always point your browser to **https://&lt;openfiler_address&gt;:446**, login and from the main screen go to the **Services** tab and enable the NFSv3 service as shown
below.&lt;/openfiler_address&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/nfs_service.png&quot;&gt;&lt;img src=&quot;/images/nfs_service.png&quot; alt=&quot;&quot; title=&quot;NFS service&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;step-2---setup-network-access&quot;&gt;Step 2 - Setup network access&lt;/h3&gt;

&lt;p&gt;From the &lt;strong&gt;System&lt;/strong&gt; tab add the network of the ESX servers as authorized. I added the whole network segment but you can also create network access rules per host in order to setup a more secure and granular access policy.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/net-access.png&quot;&gt;&lt;img src=&quot;/images/net-access.png&quot; alt=&quot;&quot; title=&quot;net-access&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;step-3---create-the-volumes&quot;&gt;Step 3 - Create the volumes&lt;/h3&gt;

&lt;p&gt;The next step is to create the volumes we are going to use as the base for the NFS shares. If like me you’re a Unix/Linux Geek it is for sure that you understand perfectly the PV -&amp;gt; VG -&amp;gt; LV** concepts if not I strongly recommend you to check the TechHead article mentioned above where Simon explained it very well or if you want to go a little deeper with volumes in Unix/Linux my article about &lt;a href=&quot;/hp-ux/linux/red%20hat/sysadmin/lvm-and-file-system-basics-in-hp-ux-linux/&quot; title=&quot;LVM and file system basics in HP-UX &amp;amp; Linux&quot;&gt;volume and filesystem basics in Linux and HP-UX&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;First we need to create the physical volumes; go to the &lt;strong&gt;Volumes&lt;/strong&gt; tab, enter the Block Devices section and edit the disk to be used for the volumes.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/edit-disk.png&quot;&gt;&lt;img src=&quot;/images/edit-disk.png&quot; alt=&quot;&quot; title=&quot;Edit disk&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Create a partition and set the type to &lt;strong&gt;Physical Volume&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/create_partition.png&quot;&gt;&lt;img src=&quot;/images/create_partition.png&quot; alt=&quot;&quot; title=&quot;create partition&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Once the Physical Volume is created go to the &lt;strong&gt;Volume Groups&lt;/strong&gt; section and create a new VG and use for it the new PV.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/vg_nfs.png&quot;&gt;&lt;img src=&quot;/images/vg_nfs.png&quot; alt=&quot;&quot; title=&quot;vg_nfs&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Finally click on &lt;strong&gt;Add Volume&lt;/strong&gt;. In this section you will have to choose the new VG that will contain the new volume, the size, name description and more important the &lt;strong&gt;Filesystem/Volume Type&lt;/strong&gt;. There are three type:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;iSCSI&lt;/li&gt;
  &lt;li&gt;XFS&lt;/li&gt;
  &lt;li&gt;Ext3&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The first is obviously intended for iSCSI volume and the other two for NFS, the criteria to follow here is the scalability since esxt3 supports up to 8TB and XFS up to 10TB.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/11/volume-creation.png&quot;&gt;&lt;img src=&quot;/images/volume-creation.png&quot; alt=&quot;&quot; title=&quot;Logical Volume creation&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Click &lt;strong&gt;Create&lt;/strong&gt; and the new volume will be created.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/new_volume.png&quot;&gt;&lt;img src=&quot;/images/new_volume.png&quot; alt=&quot;&quot; title=&quot;New Volume&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;step-4---create-the-nfs-share&quot;&gt;Step 4 - Create the NFS share&lt;/h3&gt;

&lt;p&gt;Go to the &lt;strong&gt;Shares&lt;/strong&gt; tab, there you will find the new volume as an available share.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/shares.png&quot;&gt;&lt;img src=&quot;/images/shares.png&quot; alt=&quot;&quot; title=&quot;shares&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Just to clarify concepts, &lt;strong&gt;this volume IS NOT the real NFS share&lt;/strong&gt;. We are going to create a folder into the volume and share that folder through NFS to our ESX/ESXi servers.&lt;/p&gt;

&lt;p&gt;Click into the volume name and in the pop-up enter the name of the folder and click &lt;strong&gt;Create folder&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/create_folder.png&quot;&gt;&lt;img src=&quot;/images/create_folder.png&quot; alt=&quot;&quot; title=&quot;Create Folder&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Select the folder and in the pop-up click the &lt;strong&gt;Make Share&lt;/strong&gt; button.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/make_share.png&quot;&gt;&lt;img src=&quot;/images/make_share.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Finally we are going to configure the newly created share; select the share to enter its configuration area.&lt;/p&gt;

&lt;p&gt;Edit the share data to your suit and select the &lt;strong&gt;Access Control Mode&lt;/strong&gt;. Two modes are available:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Public guest access - There is no user based authentication.&lt;/li&gt;
  &lt;li&gt;Controlled access - The authentication is defined in the Accounts section.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;/images/edit_share1.png&quot;&gt;&lt;img src=&quot;/images/edit_share1.png&quot; alt=&quot;&quot; title=&quot;Edit share&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Since this is only for my homelab I choose Public access.&lt;/p&gt;

&lt;p&gt;Next select the share type, for our purposes case I obviously choose NFS and set the permissions as Read-Write.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/configure_nfs1.png&quot;&gt;&lt;img src=&quot;/images/configure_nfs1.png&quot; alt=&quot;&quot; title=&quot;Configure NFS&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can also edit the NFS options and configure to suit your personal preferences and/or specifications.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/nfs_options.png&quot;&gt;&lt;img src=&quot;/images/nfs_options.png&quot; alt=&quot;&quot; title=&quot;NFS options&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Just a final tip for the non-Unix people, if you want to check the NFS share open a SSH session with Openfiler server and as root issue the command &lt;code&gt;showmount -e&lt;/code&gt;. The output should look like this.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/nfs_check.png&quot;&gt;&lt;img src=&quot;/images/nfs_check.png&quot; alt=&quot;&quot; title=&quot;nfs_check&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The Openfiler configuration is done, now we are going to create a new datastore in our ESX servers.&lt;/p&gt;

&lt;h3 id=&quot;step-5---add-the-datastore-to-the-esx-servers&quot;&gt;Step 5 - Add the datastore to the ESX servers&lt;/h3&gt;

&lt;p&gt;Now that the share is created and configured it is time to add it to our ESX servers.&lt;/p&gt;

&lt;p&gt;As usually from the vSphere Client go to &lt;strong&gt;Configuration -&amp;gt; Storage -&amp;gt; Add storage&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;In the pop-up window choose &lt;strong&gt;Network File System&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/11/add_nfs_1.png&quot;&gt;&lt;img src=&quot;/images/add_nfs_1.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Enter in the &lt;strong&gt;Server&lt;/strong&gt;, &lt;strong&gt;Folder&lt;/strong&gt; and &lt;strong&gt;Datastore Name&lt;/strong&gt; label.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/add_nfs_2.png&quot;&gt;&lt;img src=&quot;/images/add_nfs_2.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Finally check the data and click finish. If everything goes well after a few seconds the new datastore should appear.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/nfs_datastore1.png&quot;&gt;&lt;img src=&quot;/images/nfs_datastore1.png&quot; alt=&quot;&quot; title=&quot;nfs_datastore1&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And with this we are finished. If you see any mistake or have anything to add please comment.&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/storage/virtualization/vmware/configure-nfs-shares-in-openfiler-for-your-vsphere-homelab/&quot;&gt;Configure NFS shares in Openfiler for your vSphere homelab&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on November 30, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[Understanding RAID management in Linux]]></title>
  <link rel="alternate" type="text/html" href="/linux/understanding-raid-management-in-linux/" />
  <id>/linux/understanding-raid-management-in-linux</id>
  <published>2010-11-24T00:32:57+01:00</published>
  <updated>2010-11-24T00:32:57+01:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;The first thing you must learn about RAID technologies in Linux is that they have nothing in common with HP-UX, and I mean nothing! Yes there is LVM but that’s all, the mirror of a volume group for example is not done through LVM commands, in fact you are not going to mirror a volume group but the block device/s where the volume group resides.&lt;/p&gt;

&lt;p&gt;There are two tools to manage RAID in Linux.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;dmraid&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;mdadm&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;dmraid&lt;/code&gt; is used to discover and activate software (ATA)RAID arrays, commonly known as fakeRAID, and &lt;code&gt;mdadm&lt;/code&gt; is used to manage Linux Software RAID devices.&lt;/p&gt;

&lt;h3 id=&quot;dmraid&quot;&gt;dmraid&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;dmraid&lt;/code&gt;, uses &lt;code&gt;libdevmapper&lt;/code&gt; and the device-mapper kernel driver to perform all the tasks.&lt;/p&gt;

&lt;p&gt;The device-mapper is a component of the Linux Kernel. This the way the Linux Kernel do all the block device management. It maps a block device onto another and forms the base of volume management (&lt;a href=&quot;http://sources.redhat.com/lvm2/&quot; title=&quot;LVM2&quot;&gt;LVM2&lt;/a&gt; and &lt;a href=&quot;http://evms.sourceforge.net/&quot; title=&quot;EVMS&quot;&gt;EVMS&lt;/a&gt;) and software raid. Multipathing support is also provided through the device-mapper.
Device-mapper support is present in 2.6 kernels although there are patches for the most recent versions of 2.4 kernel version.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;dmraid&lt;/code&gt; supports several array types.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@caladan ~]# dmraid -l
asr     : Adaptec HostRAID ASR (0,1,10)
ddf1    : SNIA DDF1 (0,1,4,5,linear)
hpt37x  : Highpoint HPT37X (S,0,1,10,01)
hpt45x  : Highpoint HPT45X (S,0,1,10)
isw     : Intel Software RAID (0,1)
jmicron : JMicron ATARAID (S,0,1)
lsi     : LSI Logic MegaRAID (0,1,10)
nvidia  : NVidia RAID (S,0,1,10,5)
pdc     : Promise FastTrack (S,0,1,10)
sil     : Silicon Image(tm) Medley(tm) (0,1,10)
via     : VIA Software RAID (S,0,1,10)
dos     : DOS partitions on SW RAIDs
[root@caladan ~]#&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Following are a couple of examples to show &lt;code&gt;dmraid&lt;/code&gt; operation.&lt;/p&gt;

&lt;h4 id=&quot;array-discovering&quot;&gt;Array discovering&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@caladan ~]# dmraid -r
/dev/dm-46: hpt45x, &amp;quot;hpt45x_chidjhaiaa-0&amp;quot;, striped, ok, 320172928 sectors, data@ 0
/dev/dm-50: hpt45x, &amp;quot;hpt45x_chidjhaiaa-0&amp;quot;, striped, ok, 320172928 sectors, data@ 0
/dev/dm-54: hpt45x, &amp;quot;hpt45x_chidjhaiaa-1&amp;quot;, striped, ok, 320172928 sectors, data@ 0
/dev/dm-58: hpt45x, &amp;quot;hpt45x_chidjhaiaa-1&amp;quot;, striped, ok, 320172928 sectors, data@ 0

[root@caladan ~]#&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;activate-all-discovered-arrays&quot;&gt;Activate all discovered arrays&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@caladan ~]# dmraid -ay&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;deactivate-all-discovered-arrays&quot;&gt;Deactivate all discovered arrays&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@caladan ~]# dmraid -an&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&quot;mdadm&quot;&gt;mdadm&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;mdadm&lt;/code&gt;, is a tool to manage the Linux software RAID arrays. This tool has nothing to do with the device-mapper, in fact the device-mapper is not aware of the RAID arrays created with &lt;code&gt;mdadm&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;To illustrate this take a look at the screenshot below. I created a RAID1 device, &lt;code&gt;/dev/md0&lt;/code&gt;, I then show its configuration with  &lt;code&gt;mdadm --detail&lt;/code&gt;. Later with &lt;em&gt;dmsetup ls&lt;/em&gt; I list all the block devices seen by the device-mapper, as you can see there is no reference to &lt;code&gt;/dev/md0&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/11/dmsetup-mdadm1.png&quot;&gt;&lt;img src=&quot;/images/dmsetup-mdadm1.png&quot; alt=&quot;&quot; title=&quot;dmsetup mdadm&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Instead &lt;code&gt;mdadm&lt;/code&gt; uses the MD (Multiple Devices) device driver, this driver provides virtual devices created from another independent devices. Currently the MD driver supports the following RAID levels and configurations&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;RAID1&lt;/li&gt;
  &lt;li&gt;RAID4&lt;/li&gt;
  &lt;li&gt;RAID5&lt;/li&gt;
  &lt;li&gt;RAID6&lt;/li&gt;
  &lt;li&gt;RAID0&lt;/li&gt;
  &lt;li&gt;LINEAR (a concatenated array)&lt;/li&gt;
  &lt;li&gt;MULTIPATH&lt;/li&gt;
  &lt;li&gt;FAULTY (an special failed array type for testing purposes)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The configuration of the MD devices is contained in the &lt;code&gt;/etc/mdadm.conf&lt;/code&gt; file.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@caladan ~]# cat mdadm.conf
ARRAY /dev/md1 level=raid5 num-devices=3 spares=1 UUID=5c9d6a69:4a0f120b:f6b02789:3bbc8698
ARRAY /dev/md0 level=raid1 num-devices=2 UUID=b36f1b1c:87cf9497:73b81e8c:79ee3c44
[root@caladan ~]#&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code&gt;mdadm&lt;/code&gt; tool has seven operation modes.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Assemble&lt;/li&gt;
  &lt;li&gt;Build&lt;/li&gt;
  &lt;li&gt;Create&lt;/li&gt;
  &lt;li&gt;Manage&lt;/li&gt;
  &lt;li&gt;Misc&lt;/li&gt;
  &lt;li&gt;Follow or Monitor&lt;/li&gt;
  &lt;li&gt;Grow&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;A more detailed description of every major operation mode is provided in &lt;code&gt;mdadm&lt;/code&gt; man page.&lt;/p&gt;

&lt;p&gt;Finally below are examples of some of the more common operations with &lt;code&gt;mdadm&lt;/code&gt;.&lt;/p&gt;

&lt;h4 id=&quot;create-a-raid1-array&quot;&gt;Create a RAID1 array&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@caladan ~]# mdadm --create /dev/md1 --verbose --level raid1 --raid-devices 2 /dev/sd[de]1
mdadm: size set to 1044096K
mdadm: array /dev/md1 started.
[root@caladan ~]#&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;get-detailed-configuration-of-the-array&quot;&gt;Get detailed configuration of the array&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@caladan ~]# mdadm --query --detail /dev/md1
/dev/md1:
            Version : 00.90.01
      Creation Time : Tue Nov 23 22:37:05 2010
         Raid Level : raid1
         Array Size : 1044096 (1019.80 MiB 1069.15 MB)
        Device Size : 1044096 (1019.80 MiB 1069.15 MB)
       Raid Devices : 2
      Total Devices : 2
    Preferred Minor : 1
        Persistence : Superblock is persistent

        Update Time : Tue Nov 23 22:37:11 2010
              State : clean
     Active Devices : 2
    Working Devices : 2
     Failed Devices : 0
      Spare Devices : 0

               UUID : c1893118:c1327582:7dc3a667:aa87dfeb
             Events : 0.2

        Number   Major   Minor   RaidDevice State
           0       8       49        0      active sync   /dev/sdd1
           1       8       65        1      active sync   /dev/sde1
[root@caladan ~]#&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;destroy-the-array&quot;&gt;Destroy the array&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@caladan ~]# mdadm --remove /dev/md1
[root@caladan ~]# mdadm --stop /dev/md1
[root@caladan ~]# mdadm --detail /dev/md1
mdadm: md device /dev/md1 does not appear to be active.
[root@caladan ~]#&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;create-a-raid5-array-with-an-spare-device&quot;&gt;Create a RAID5 array with an spare device&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@caladan ~]# mdadm --create /dev/md1 --verbose --level raid5 --raid-devices 3 --spare-devices 1 /dev/sd[def]1 /dev/sdg1
mdadm: array /dev/md1 started
[root@caladan ~]#&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;check-for-the-status-of-a-task-into-the-procmdstat-file&quot;&gt;Check for the status of a task into the /proc/mdstat file.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@caladan ~]# cat /proc/mdstat
Personalities : [raid6] [raid5] [raid4]
md0 : active raid6 sdi1[7] sdh1[6] sdg1[5] sdf1[4] sde1[3] sdd1[2] sdc1[1] sdb1[0]
             226467456 blocks level 6, 64k chunk, algorithm 2 [8/8] [UUUUUUUU]
             [=========&amp;gt;...........]  resync = 49.1% (18552320/37744576) finish=11.4min speed=27963K/sec

unused devices: &amp;lt;none&amp;gt;
[root@caladan ~]#&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;generate-the-mdadmconf-file-from-the-current-active-devices&quot;&gt;Generate the mdadm.conf file from the current active devices.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@caladan ~]# mdadm --detail --scan
ARRAY /dev/md1 level=raid5 num-devices=3 spares=1 UUID=5c9d6a69:4a0f120b:f6b02789:3bbc8698
ARRAY /dev/md0 level=raid1 num-devices=2 UUID=b36f1b1c:87cf9497:73b81e8c:79ee3c44
[root@caladan ~]# mdadm --detail --scan &amp;gt;&amp;gt; mdadm.conf&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As a final thought, my recommendation is that if there is hardware RAID controller available, like the HP Smart Array P400 for example, go hard-RAID five by five and if not always use &lt;code&gt;mdadm&lt;/code&gt; even if there is an onboard RAID controller.&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/linux/understanding-raid-management-in-linux/&quot;&gt;Understanding RAID management in Linux&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on November 24, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[HP P4000: Generating the CLIQ key file]]></title>
  <link rel="alternate" type="text/html" href="/hp/storage/hp-p4000-generating-the-cliq-key-file/" />
  <id>/hp/storage/hp-p4000-generating-the-cliq-key-file</id>
  <published>2010-11-02T00:11:03+01:00</published>
  <updated>2010-11-02T00:11:03+01:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;As I explained in my &lt;a href=&quot;/hp/storage/cliq-the-hp-lefthand-saniq-command-line/&quot;&gt;first post&lt;/a&gt; about the SAN/iQ command line, to remotely manage a P4000 storage array instead of
providing the username/password credentials in every command you can specify an encrypted file which contains the user/password information.&lt;/p&gt;

&lt;p&gt;To create this file, known as the key file, just use the &lt;code&gt;createKey&lt;/code&gt; command and provide the username, password, array IP address or DNS name and the name of the file.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/key-file.png&quot;&gt;&lt;img src=&quot;/images/key-file.png&quot; alt=&quot;&quot; title=&quot;key-file&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;By default the key file is created in the user’s home directory, &lt;code&gt;C:\Documents and Settings\&amp;lt;username&amp;gt;&lt;/code&gt; in Windows XP/2003 and &lt;code&gt;C:\Users\&amp;lt;username&amp;gt;&lt;/code&gt; in Windows Vista/2008/7.&lt;/p&gt;

&lt;p&gt;The file can also be stored in a secure location on the local network, in that case the full path to the key file must be provided.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/getclusterinfo.png&quot;&gt;&lt;img src=&quot;/images/getclusterinfo.png&quot; alt=&quot;&quot; title=&quot;getclusterinfo&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Of course the main reason to create a key file, apart from ease the daily management, is to provide a valid authentication mechanism for any automation script that you can create using the &lt;code&gt;cliq&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/hp/storage/hp-p4000-generating-the-cliq-key-file/&quot;&gt;HP P4000: Generating the CLIQ key file&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on November 02, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[How to rescan the SCSI bus in Linux]]></title>
  <link rel="alternate" type="text/html" href="/hp/linux/storage/sysadmin/how-to-rescan-the-scsi-bus-in-linux/" />
  <id>/hp/linux/storage/sysadmin/how-to-rescan-the-scsi-bus-in-linux</id>
  <published>2010-10-28T15:09:31+02:00</published>
  <updated>2010-10-28T15:09:31+02:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;You are in front of a Linux box, a VM really, with a bunch of new disks that must be configured and suddenly you remember that there is no &lt;code&gt;ioscan&lt;/code&gt; in Linux, you will ask yourself, who is so stupid to create an operative system without &lt;code&gt;ioscan&lt;/code&gt;?&lt;/p&gt;

&lt;p&gt;Yes it is true, there is no &lt;code&gt;ioscan&lt;/code&gt; in Linux and that means that every time you add a new disk to one of your virtual machine you have to reboot it, at least technically that is the truth. But don’t worry there is a quick and dirty way to circumvent that.&lt;/p&gt;

&lt;p&gt;From a root shell execute the following command:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@redhat ~]# echo &amp;quot;- - -&amp;quot; &amp;gt; /sys/class/scsi_host/&amp;lt;host_number&amp;gt;/scan&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;After that if you do a &lt;code&gt;fdsik -l&lt;/code&gt; will see the new disks.&lt;/p&gt;

&lt;p&gt;If you want to rescan your box for new fiber channel disks the command is slightly different.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@redhat ~# echo &amp;quot;1&amp;quot; &amp;gt; /sys/class/fc_host/host#/issue_lip&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;For the fiber channel part there are also third party utilities. HP for example provides &lt;code&gt;hp_rescan&lt;/code&gt; which comes with the &lt;a href=&quot;http://h18013.www1.hp.com/products/servers/management/psp/index.html?jumpid=servers/psp&quot;&gt;Proliant Support Pack&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@redhat /]# hp_rescan -h
hp_rescan: rescans LUNs on HP supported FC adapters
Usage: hp_rescan -ailh[n]

-a: rescan all adapters
-i: rescan a specific adapter instance. The specific device should be a
 SCSI host number such as &amp;quot;0&amp;quot; or &amp;quot;6&amp;quot;
-l: lists all FC adapters
-n: do not perform &amp;quot;scsi remove-single-device&amp;quot; when executing probe-luns
-h: help
[root@redhat /]#&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;If you know other ways to rescan the SCSI bus in a Linux server please comment.&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/hp/linux/storage/sysadmin/how-to-rescan-the-scsi-bus-in-linux/&quot;&gt;How to rescan the SCSI bus in Linux&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on October 28, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[HP resources for VMware]]></title>
  <link rel="alternate" type="text/html" href="/hp/storage/virtualization/vmware/hp-resources-for-vmware/" />
  <id>/hp/storage/virtualization/vmware/hp-resources-for-vmware</id>
  <published>2010-10-20T15:48:05+02:00</published>
  <updated>2010-10-20T15:48:05+02:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    
  </author>
  <content type="html">
    &lt;p&gt;The reason for this post is trying to be a single point of reference for HP related VMware resources.&lt;/p&gt;

&lt;p&gt;I created the list for my personal use while ago but in the hope that it can be useful for someone else I decided to review and share it. I will try to keep the list up to date and also add it as a permanent page in the menu above.&lt;/p&gt;

&lt;h4 id=&quot;general-resources&quot;&gt;General resources&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.hp.com/go/vmware&quot;&gt;&lt;strong&gt;HP virtualization with VMware&lt;/strong&gt;&lt;/a&gt; - This is the main page about VMware in the HP site. It has dozens of links to White Papers, webinars, podcasts and other HP sites about VMware.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.vmware.com/solutions/partners/alliances/hp.html&quot;&gt;&lt;strong&gt;HP and VMware Virtualization Alliance&lt;/strong&gt;&lt;/a&gt; - The HP-VMware Alliance page in the VMware site. It has several areas that outline the different HP-VMware joint solutions.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://h20195.www2.hp.com/v2/erl.aspx?keywords=vmware&amp;amp;doctype=all&amp;amp;prodtype=3447589%7C15351%7C3709945%7C329290%7C18964%7C457757%7C31987&amp;amp;docreg=ww%7Cus&amp;amp;segment=leb%7Csmb&amp;amp;query=yes&quot;&gt;&lt;strong&gt;VMware Enterprise Library at HP&lt;/strong&gt;&lt;/a&gt; – Case studies, White Papers and Datasheets.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://h18004.www1.hp.com/products/servers/management/unified/infolibraryicv.html&quot;&gt;&lt;strong&gt;HP Insight Control for VMware vCenter Server&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;vmware-on-proliant&quot;&gt;VMware on ProLiant&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://h71028.www7.hp.com/enterprise/us/en/servers/4x-servers.html&quot;&gt;&lt;strong&gt;ProLiant server VMware support matrix&lt;/strong&gt;&lt;/a&gt; - This page is the &lt;strong&gt;Rosetta Stone&lt;/strong&gt; for every VMware installation on HP hardware. It has every HP Proliant Blade/Server cross-referenced in a table with every ESX/ESXi version from the 2.1 to the 4.1. The vSphere tab has also a column about VMware FT support.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://h20324.www2.hp.com/SDP/Content/ContentListing.aspx?booth=39&amp;amp;tag=65&quot;&gt;&lt;strong&gt;VMware demos in HP hardware&lt;/strong&gt;&lt;/a&gt; – This site has a few interesting videos demoing VMware products in HP hardware.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://h20392.www2.hp.com/portal/swdepot/displayProductInfo.do?productNumber=HPVM08&quot;&gt;ESX4 images&lt;/a&gt;&lt;/strong&gt; for the G7 ProLiant Blades.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://h71019.www7.hp.com/activeanswers/cache/120132-0-0-0-121.html&quot;&gt;&lt;strong&gt;HP sizing tool for VMware vSphere&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;a href=&quot;http://h20000.www2.hp.com/bizsupport/TechSupport/SoftwareDescription.jsp?lang=en&amp;amp;cc=us&amp;amp;prodTypeId=3709945&amp;amp;prodSeriesId=4194735&amp;amp;prodNameId=4194638&amp;amp;swEnvOID=4040&amp;amp;swLang=13&amp;amp;mode=2&amp;amp;taskId=135&amp;amp;swItem=MTX-cd4d37bc8df74075b90b187074&quot;&gt;HP Management Agents for ESX 4.x&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;a href=&quot;http://h20195.www2.hp.com/V2/GetPDF.aspx/4AA2-9642ENW.pdf&quot;&gt;HP Virtual Connect Flex-10 and VMware vSphere 4.0&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;a href=&quot;http://h20195.www2.hp.com/V2/GetPDF.aspx/4AA2-9442ENW.pdf&quot;&gt;Cisco Nexus 1000V on HP BladeSystem&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;hp-storageworks&quot;&gt;HP StorageWorks&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://h71028.www7.hp.com/enterprise/us/en/solutions/storage-vmware.html&quot;&gt;&lt;strong&gt;VMware Storage Solutions from HP&lt;/strong&gt;&lt;/a&gt; – Includes the ESX/ESXi 3.x and 4.x support matrices for HP Storageworks systems.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://h20195.www2.hp.com/V2/GetPDF.aspx/4AA3-0261ENW.pdf&quot;&gt;&lt;strong&gt;Running VMware vSphere 4 on HP LeftHand P4000 SAN Solutions&lt;/strong&gt;&lt;/a&gt; – Excellent White Paper, a must for every VMware-Lefthand infrastructure.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;a href=&quot;http://h20195.www2.hp.com/V2/GetPDF.aspx/4AA1-2185ENW.pdf&quot;&gt;HP EVA and vSphere 4 best practices&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;a href=&quot;http://h20195.www2.hp.com/V2/GetPDF.aspx/4AA3-0450ENW.pdf&quot;&gt;HP XP24000 and vSphere 4 best practices&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;a href=&quot;http://h30507.www3.hp.com/t5/Around-the-Storage-Block-Blog/VMware-vCenter-Plug-in-for-HP-StorageWorks-Arrays/bc-p/79724&quot;&gt;VMware vCenter Plug-in for HP StorageWorks Arrays&lt;/a&gt; –&lt;/strong&gt; Great video by &lt;a href=&quot;http://www.hp.com/storage/blog&quot;&gt;Calvin Zito&lt;/a&gt; (@&lt;a href=&quot;http://twitter.com/#!/hpstorageguy&quot;&gt;HPStorareGuy&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://h30507.www3.hp.com/t5/Around-the-Storage-Block-Blog/VAAI-Demo-at-VMworld/ba-p/82295&quot;&gt;&lt;strong&gt;HP P4000 VAAI demo&lt;/strong&gt;&lt;/a&gt; - Video of the demo showed at VMworld 2010 San Francisco.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://h20000.www2.hp.com/bizsupport/TechSupport/ProductList.jsp?lang=en&amp;amp;cc=uk&amp;amp;taskId=135&amp;amp;prodTypeId=18964&amp;amp;prodSeriesId=499896&quot;&gt;&lt;strong&gt;HP StorageWorks drivers&lt;/strong&gt;&lt;/a&gt; – Including the virtualization adapters for VMware SRM for EVA, XP and P4000 systems&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;a href=&quot;http://h18006.www1.hp.com/products/storage/software/vsa/index.html&quot;&gt;HP P4000 VSA&lt;/a&gt;&lt;/strong&gt; – Product page of my beloved VSA :-)&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;vdi&quot;&gt;VDI&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://h18013.www1.hp.com/products/servers/virtualization/index.html&quot;&gt;&lt;strong&gt;HP Client Virtualization&lt;/strong&gt;&lt;/a&gt; – HP main site about VDI, not exclusively about VMware but very interesting.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://h18004.www1.hp.com/products/servers/software/vmware/virtualization/vdi/index.html&quot;&gt;&lt;strong&gt;HP Virtual Desktop Infrastructure with VMware View&lt;/strong&gt;&lt;/a&gt; – HP VDI solution with VMware View main site.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://h20195.www2.hp.com/v2/GetPDF.aspx/4AA1-9454ENW.pdf&quot;&gt;&lt;strong&gt;HP Reference Architecture for VMware View with HP StorageWorks P4800 BladeSystem SAN&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;vcloud-director&quot;&gt;vCloud Director&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;&lt;a href=&quot;http://ebcsdp.houston.hp.com/SDP/Content/ContentDetails.aspx?ID=2515&amp;amp;booth=63&amp;amp;tag=493&amp;amp;portal=1&quot;&gt;HP Cloud Map with BladeSystem Matrix for VMware vCloud Director&lt;/a&gt;&lt;/strong&gt; – A demo showing what can be done by combining the HP Matrix and the awesome vCloud Director.&lt;/li&gt;
&lt;/ul&gt;

    &lt;p&gt;&lt;a href=&quot;/hp/storage/virtualization/vmware/hp-resources-for-vmware/&quot;&gt;HP resources for VMware&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on October 20, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[HP Lefthand P4000 VSA verbose boot]]></title>
  <link rel="alternate" type="text/html" href="/storage/virtualization/hp-lefthand-p4000-vsa-verbose-boot/" />
  <id>/storage/virtualization/hp-lefthand-p4000-vsa-verbose-boot</id>
  <published>2010-10-13T21:06:16+02:00</published>
  <updated>2010-10-13T21:06:16+02:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;If you are a user of the P4000 VSA you’ll be use to the quiet boot sequence of the SAN/iQ software. Just a couple of messages until you get the login prompt.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/p4000-vsa_clean_boot.jpg&quot;&gt;&lt;img src=&quot;/images/p4000-vsa_clean_boot.jpg&quot; alt=&quot;&quot; title=&quot;P4000-VSA_clean_boot&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But how about if anyone want to watch the whole boot process to check error messages or something alike? There is an easy and simple solution, at the beginning of the boot sequence press &lt;em&gt;ESC&lt;/em&gt; in order to stop the bootloader and when the &lt;code&gt;boot:&lt;/code&gt; prompt appears type &lt;code&gt;vga&lt;/code&gt; and press Enter.&lt;/p&gt;

&lt;p&gt;After that you will have a normal boot process like with any other Linux system.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/p4000-vsa_full_boot.png&quot;&gt;&lt;img src=&quot;/images/p4000-vsa_full_boot.png&quot; alt=&quot;&quot; title=&quot;P4000-VSA_full_boot&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/storage/virtualization/hp-lefthand-p4000-vsa-verbose-boot/&quot;&gt;HP Lefthand P4000 VSA verbose boot&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on October 13, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[Cisco UCS Platform Emulator, first impressions]]></title>
  <link rel="alternate" type="text/html" href="/cisco/virtualization/cisco-ucs-platform-emulator-first-impressions/" />
  <id>/cisco/virtualization/cisco-ucs-platform-emulator-first-impressions</id>
  <published>2010-10-12T23:16:40+02:00</published>
  <updated>2010-10-12T23:16:40+02:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;Although I
work at HP, a few of days ago I decided to try the Cisco UCS Platform Emulator. I’ve been using HP blades and Virtual Connect for years so I thought that it would be great to get a small taste of its most direct competitor. And, of course, this is my blog and not an HP blog so I can try and write about anything I want :-)&lt;/p&gt;

&lt;p&gt;The UCS Platform Emulator can be freely downloaded from the Cisco DeveloperNetwork &lt;a href=&quot;http://developer.cisco.com/web/unifiedcomputing/ucsemulatordownload&quot;&gt;here&lt;/a&gt;, you just need to fill a small form. It is also very recommendable to grab a copy of the emulator guide &lt;a href=&quot;http://developer.cisco.com/c/document_library/get_file?p_l_id=2049008&amp;amp;groupId=2048839&amp;amp;folderId=2049143&amp;amp;name=DLFE-29106.pdf&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The emulator is virtual machine with a &lt;a href=&quot;http://www.centos.org/&quot;&gt;Linux CentOS&lt;/a&gt; inside, you can run it with VMware Workstation as I do or with the free VMware Player. After firing it up,
the startup process will go like any RedHat based Linux until you will get to a &lt;code&gt;Starting cisco_ucspe&lt;/code&gt; message. Then It will start to decompress and install the emulator into the VM.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/cisco-ucs-platform-emulator-install.png&quot;&gt;&lt;img src=&quot;/images/cisco-ucs-platform-emulator-install.png&quot; alt=&quot;&quot; title=&quot;Cisco UCS Platform Emulator install&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;After that process is finished you will get to login screen that ask you to use the user and password &lt;em&gt;config&lt;/em&gt; in order to access the configuration menus of the UCSPE. From those menus you can set stuff like the number of UCS chassis to be used and the number of blades per chassis for example.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/cisco-ucs-platform-emulator-config1.png&quot;&gt;&lt;img src=&quot;/images/cisco-ucs-platform-emulator-config1.png&quot; alt=&quot;&quot; title=&quot;Cisco UCS Platform Emulator config&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Once you have configured the emulator point your web browser to the IP address of the emulator to access the UCS Manager. The network the UCSPE virtual machines is connected to must be configured to provide IP addresses with DHCP, I used the default NAT network the UCSPE came with. When you are in the web browser click the &lt;strong&gt;LAUNCH&lt;/strong&gt; link.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/ucs_web_access.jpg&quot;&gt;&lt;img src=&quot;/images/ucs_web_access.jpg&quot; alt=&quot;&quot; title=&quot;UCS_web_access&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And here it is, in all its magnificence, the Cisco Unified ComputingSystem Manager.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/ucs_manager.jpg&quot;&gt;&lt;img src=&quot;/images/ucs_manager.jpg&quot; alt=&quot;&quot; title=&quot;UCS_manager&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From here I will get familiar with the manager and try things like UCS Service Profile creation or playing with the UCS API. I will try to write about it in a future post.&lt;/p&gt;

&lt;p&gt;Just a final word. I am very pleased with emulator; have to admit that Cisco did a great work, the whole “thing” was up and running in a breeze and provides you with a very almost-real experience of the UCS platform.&lt;/p&gt;

&lt;p&gt;I firmly believe that this is the correct direction that every vendor should follow, yes including HP. If they release simulators to the IT people out there, in the end it will beneficial for them.&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/cisco/virtualization/cisco-ucs-platform-emulator-first-impressions/&quot;&gt;Cisco UCS Platform Emulator, first impressions&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on October 12, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[HP Lefthand VSA minimum memory requirements]]></title>
  <link rel="alternate" type="text/html" href="/storage/virtualization/hp-lefthand-vsa-minimum-memory-requirements/" />
  <id>/storage/virtualization/hp-lefthand-vsa-minimum-memory-requirements</id>
  <published>2010-09-17T11:43:36+02:00</published>
  <updated>2010-09-17T11:43:36+02:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;These week I’ve trying to stretch the virtualization resources of my homelab as much as possible. In my obsession to run as many VMs as possible I decided to lower the memory of some of them, including my storage appliances.&lt;/p&gt;

&lt;p&gt;My VSAs are configured with various amounts of RAM ranging from 384MB to 1GB. I took the one I have in my laptop for demo purposes, powered it off, set the RAM to 256MB and fired it up again.&lt;/p&gt;

&lt;p&gt;The VSA seemed to start without any problems and from the console everything looked fine.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/vsa_console1.jpg&quot;&gt;&lt;img src=&quot;/images/vsa_console1.jpg&quot; alt=&quot;&quot; title=&quot;VSA console&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I started the CMC and quickly noticed that something was wrong, the status of the storage server was offline.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/storage_server_offline.jpg&quot;&gt;&lt;img src=&quot;/images/storage_server_offline.jpg&quot; alt=&quot;&quot; title=&quot;storage_server_offline&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I then looked into the alerts area and found one saying that there was not enough ram to start the configured features.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/no-memory.jpg&quot;&gt;&lt;img src=&quot;/images/no-memory.jpg&quot; alt=&quot;&quot; title=&quot;Not enough memory&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;OK then, the VSA doesn’t work with 256MB of RAM; so which value is the minimum required in order to run the storage services?&lt;/p&gt;

&lt;p&gt;After looking into several docs I found the answer in the &lt;a href=&quot;http://bizsupport2.austin.hp.com/bc/docs/support/SupportManual/c02063198/c02063198.pdf&quot;&gt;P4000 Quick Start VSA user guide&lt;/a&gt;. The minimum amount of RAM required is 384MB for the laptop version and 1GB for the ESX version. Also in the VSA Install and Configure Guide, that comes with the VSA, the following values are provided for the ESX version and for the new Hyper-V version:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;500GB to 4.5TB - 1GB of RAM&lt;/li&gt;
  &lt;li&gt;4.5TB to 9TB - 2GB of RAM&lt;/li&gt;
  &lt;li&gt;9TB to 10TB - 3GB of RAM&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;After that I configured again the VSA with 384MB and the problem was fixed and the alarm disappeared.&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/storage/virtualization/hp-lefthand-vsa-minimum-memory-requirements/&quot;&gt;HP Lefthand VSA minimum memory requirements&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on September 17, 2010.&lt;/p&gt;
  </content>
</entry>


  

<entry>
  <title type="html"><![CDATA[Enabling vSphere Web Access]]></title>
  <link rel="alternate" type="text/html" href="/sysadmin/virtualization/vmware/enabling-the-vsphere-web-access/" />
  <id>/sysadmin/virtualization/vmware/enabling-the-vsphere-web-access</id>
  <published>2010-09-15T16:56:49+02:00</published>
  <updated>2010-09-15T16:56:49+02:00</updated>
  <author>
    <name>Juan Manuel Rey</name>
    <uri></uri>
    <email>Juan Manuel Rey</email>
  </author>
  <content type="html">
    &lt;p&gt;If you are in the virtualization business you’ll probably know that since the release of vSphere back in 2009 the web access the ESX servers has been disabled by default. I really never minded about this, I still have nightmares with the awful and useless web interface of the ESX3, and to be sincere who needs a web access when you have SSH access, &lt;a href=&quot;http://communities.vmware.com/community/vmtn/vsphere/automationtools/powercli?ie=UTF-8&amp;amp;q=powercli&quot;&gt;PowerCLI&lt;/a&gt; and the almighty vSphere Client.&lt;/p&gt;

&lt;p&gt;But recently I found myself only with a Linux machine and no remote access to the vCenter Server. With a so limited range of resources I decided to try the web access but I had to enable it.&lt;/p&gt;

&lt;p&gt;The first step is to log into the host via SSH. Once you are inside the ESX and from a root shell execute the following command to start the service.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/vsphere-web-service1.png&quot;&gt;&lt;img src=&quot;/images/vsphere-web-service1.png&quot; alt=&quot;&quot; title=&quot;vSphere-web-service&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Now you can point your web browser to &lt;strong&gt;http://&amp;lt;esx_ip_address&amp;gt;/ui&lt;/strong&gt; and login as root, you will note that the interface is pretty much the same as in VMware Server 2.0.&lt;/p&gt;

&lt;p&gt;After that I wanted to make the change permanent and like in any normal RedHat Linux server I issued the classic &lt;code&gt;chkconfig&lt;/code&gt; command.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@esx41-01 ~]# chkconfig vmware-webAccess on&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I thought  that everything was done, nothing so far from the reality, after a reboot of the server the Web Access was gone.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/vsphere-web-service_21.jpg&quot;&gt;&lt;img src=&quot;/images/vsphere-web-service_21.jpg&quot; alt=&quot;&quot; title=&quot;vSphere-web-service_2&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;At that point I no longer needed to access the ESX through the web so I did not spent more time with this; but later with one of my ESX servers at home I finally found how to permanently enable the Web Access.&lt;/p&gt;

&lt;p&gt;From the vSphere Client go to the configuration tab of the ESX host and edit the Security Profile from the Software area. The pop-up window will show a list of services, look for the web access and check it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/webaccess-vsphereclient1.jpg&quot;&gt;&lt;img src=&quot;/images/webaccess-vsphereclient1.jpg&quot; alt=&quot;&quot; title=&quot;WebAccess-vSphereClient&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you now change to a SSH session and ask for the status of the service, will see the service started and enabled.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/images/webaccess-ssh.jpg&quot;&gt;&lt;img src=&quot;/images/webaccess-ssh.jpg&quot; alt=&quot;&quot; title=&quot;WebAccess-SSH&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Reboot the server, if you can of course ;-), and you’ll see that the changes are permanent.&lt;/p&gt;

&lt;p&gt;Juanma.&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/sysadmin/virtualization/vmware/enabling-the-vsphere-web-access/&quot;&gt;Enabling vSphere Web Access&lt;/a&gt; was originally published by Juan Manuel Rey at &lt;a href=&quot;&quot;&gt;Juanma's Blog&lt;/a&gt; on September 15, 2010.&lt;/p&gt;
  </content>
</entry>

</feed>
