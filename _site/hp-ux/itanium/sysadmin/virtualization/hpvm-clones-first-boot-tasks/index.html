<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>HPVM clones first boot tasks &#8211; Juanma's Blog</title>
<meta name="description" content="Welcome again to HPVM World! my dear readers :-D

">
<meta name="keywords" content="EFI, HP-UX, HPVM, Integrity VMs, Itanium, LVM, setboot, sysadmin, systems administration">

  

<!-- Twitter Cards -->
<meta name="twitter:title" content="HPVM clones first boot tasks">
<meta name="twitter:description" content="Welcome again to HPVM World! my dear readers :-D

">
<meta name="twitter:site" content="@jreypo">
<meta name="twitter:creator" content="@jreypo">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="HPVM clones first boot tasks">
<meta property="og:description" content="Welcome again to HPVM World! my dear readers :-D

">
<meta property="og:url" content="/hp-ux/itanium/sysadmin/virtualization/hpvm-clones-first-boot-tasks/">
<meta property="og:site_name" content="Juanma's Blog">

<meta property="og:image" content="/images/default-thumb.png">






<link rel="canonical" href="/hp-ux/itanium/sysadmin/virtualization/hpvm-clones-first-boot-tasks/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Juanma's Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/">Juanma's Blog</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="/about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="/posts/" >Posts</a></li>
				
				    
				        
				    
				    <li><a href="/vmware-hp-links/" >HP Resources for VMware</a></li>
				
				    
				        
				    
				    <li><a href="/tags/" >Tags</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    
  

<div itemscope itemtype="http://schema.org/Person">


	<img src="/images/bio-photo-2.jpg" class="bio-photo" alt="Juan Manuel Rey bio photo">


  <h3 itemprop="name">Juan Manuel Rey</h3>
  <p>Unix Geek. Sysadmin by heart turned cloud architect for VMware.</p>
  <a href="mailto:Juan Manuel Rey" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
  <a href="http://twitter.com/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  <a href="http://plus.google.com/+JuanManuelReyPortal" class="author-social" target="_blank"><i class="fa fa-fw fa-google-plus-square"></i> Google+</a>
  <a href="http://linkedin.com/in/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  
  
  <a href="http://github.com/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  <a href="http://stackoverflow.com/users/2454288/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> Stackoverflow</a>
  
  
  
  
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="/hp-ux/itanium/sysadmin/virtualization/hpvm-clones-first-boot-tasks/" rel="bookmark" title="HPVM clones first boot tasks">HPVM clones first boot tasks</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>Welcome again to <strong>HPVM World!</strong> my dear readers :-D</p>

<p>Have to say that even with the initial disappointment about <code>hpvmclone</code>, cloning IVMs was a very funny task but I believe that the after cloning tasks weren’t very clear, at least for me, so I decided to write this follow up post to clarify that part.</p>

<p>Let’s assume we already have a cloned virtual machine, in this particular case I used <code>dd</code> to clone the virtual disk and later I created the IVM and added the storage device and the other resources but it also applied to the other method with minor changes.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">[root@hpvmhost] ~ # hpvmstatus -P vmnode2 -d
[Virtual Machine Devices]

[Storage Interface Details]
disk:scsi:0,0,0:lv:/dev/vg_vmtest/rvmnode2disk
dvd:scsi:0,0,1:disk:/dev/rdsk/c1t4d0

[Network Interface Details]
network:lan:0,1,0xB20EBA14E76C:vswitch:localnet
network:lan:0,2,0x3E9492C9F615:vswitch:vlan02

[Misc Interface Details]
serial:com1::tty:console
[root@hpvmhost] ~ #</code></pre></div>

<p>We start the virtual machine an access its console.Now we are going to follow some of the final steps of the third method described in my previous post. From the main <code>EFI Boot Manager</code> select the <code>Boot option maintenance menu</code> option.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">EFI Boot Manager ver 1.10 [14.62] [Build: Mon Oct  1 09:27:26 2007]

Please select a boot option

     EFI Shell [Built-in]                                           
     Boot option maintenance menu                                    

     Use ^ and v to change option(s). Use Enter to select an option</code></pre></div>

<p>Select Boot from a file and the select the first partition:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">EFI Boot Maintenance Manager ver 1.10 [14.62]

Boot From a File.  Select a Volume

    IA64_EFI [Acpi(PNP0A03,0)/Pci(0|0)/Scsi(Pun0,Lun0)/HD(Part1,Sig
    IA64_EFI [Acpi(PNP0A03,0)/Pci(0|0)/Scsi(Pun0,Lun0)/HD(Part3,Sig7
    Removable Media Boot [Acpi(PNP0A03,0)/Pci(0|0)/Scsi(Pun1,Lun0)]
    Load File [Acpi(PNP0A03,0)/Pci(1|0)/Mac(B20EBA14E76C)]          
    Load File [Acpi(PNP0A03,0)/Pci(2|0)/Mac(3E9492C9F615)]        
    Load File [EFI Shell [Built-in]]                                
    Legacy Boot
    Exit</code></pre></div>

<p>Enter the EFI directory then the HPUX directory and finally select <code>hpux.file</code>. Like I said before this part is very similar to the final steps of Method 3.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">EFI Boot Maintenance Manager ver 1.10 [14.62]

Select file or change to new directory:

       03/09/10  03:45p &lt;DIR&gt;       4,096 .                         
       03/09/10  03:45p &lt;DIR&gt;       4,096 ..                        
       03/10/10  04:21p           657,609 hpux.efi                  
       03/09/10  03:45p            24,576 nbp.efi                   
       Exit</code></pre></div>

<p>After this the machine will boot.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">Filename: \EFI\HPUX\hpux.efi
 DevicePath: [Acpi(PNP0A03,0)/Pci(0|0)/Scsi(Pun0,Lun0)/HD(Part1,Sig71252358-2BCD-11DF-8000-D6217B60E588)/\EFI\HPUX\hpux.efi]
   IA-64 EFI Application 03/10/10  04:21p     657,609 bytes

(C) Copyright 1999-2008 Hewlett-Packard Development Company, L.P.
All rights reserved

HP-UX Boot Loader for IPF  --  Revision 2.036

Press Any Key to interrupt Autoboot
\EFI\HPUX\AUTO ==&gt; boot vmunix
Seconds left till autoboot -   0
AUTOBOOTING...&gt; System Memory = 2042 MB
loading section 0
..................................................................................... (complete)
loading section 1
............... (complete)
loading symbol table
loading System Directory (boot.sys) to MFS
.....
loading MFSFILES directory (bootfs) to MFS
..................
Launching /stand/vmunix
SIZE: Text:43425K + Data:7551K + BSS:22118K = Total:73096K
...</code></pre></div>

<p>When the VM is up login as root. The first tasks as always are to change hostname and network configuration to avoid conflicts.</p>

<p>Next we are going recreate <code>lvmtab</code> since the current one contains the LVM configuration of the source virtual machine. Performing a simple <code>vgdisplay</code> will show it.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">root@vmnode2:/# vgdisplay
vgdisplay: Warning: couldn&#39;t query physical volume &quot;/dev/disk/disk15_p2&quot;:
The specified path does not correspond to physical volume attached to
this volume group
vgdisplay: Warning: couldn&#39;t query all of the physical volumes.
--- Volume groups ---
VG Name                     /dev/vg00
VG Write Access             read/write     
VG Status                   available                 
Max LV                      255    
Cur LV                      8      
Open LV                     8      
Max PV                      16     
Cur PV                      1      
Act PV                      0      
Max PE per PV               3085         
VGDA                        0   
PE Size (Mbytes)            8               
Total PE                    0       
Alloc PE                    0       
Free PE                     0       
Total PVG                   0        
Total Spare PVs             0              
Total Spare PVs in use      0

root@vmnode2:/#</code></pre></div>

<p>To correct this remove the <code>/etc/lvmtab</code> file and execute a new <code>vgscan</code>.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">root@vmnode2:/# rm /etc/lvmtab
/etc/lvmtab: ? (y/n) y
root@vmnode2:/var/tmp/software# vgscan
Creating &quot;/etc/lvmtab&quot;.
vgscan: Couldn&#39;t access the list of physical volumes for volume group &quot;/dev/vg00&quot;.
Physical Volume &quot;/dev/dsk/c1t1d0&quot; contains no LVM information

*** LVMTAB has been created successfully.
*** Do the following to resync the information on the disk.
*** #1.  vgchange -a y
*** #2.  lvlnboot -R
root@vmnode2:/#</code></pre></div>

<p>Follow the recommended steps in <code>vgscan</code> output, the first step only applies if there are any other VGs in the system, if there is only <code>vg00</code> it is already active so this step is not necessary.</p>

<p>Running <code>lvnlboot -R</code> is mandatory since we need to recover and update the links to the logical volumes in the Boot Data Reserved Area of the booting disk.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">root@vmnode2:/# lvlnboot -R
Volume Group configuration for /dev/vg00 has been saved in /etc/lvmconf/vg00.conf
root@vmnode2:/#</code></pre></div>

<p>Now the LVM configuration is fixed, try again the <code>vgdisplay</code> command.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">root@vmnode2:/# vgdisplay
--- Volume groups ---
VG Name                     /dev/vg00
VG Write Access             read/write
VG Status                   available
Max LV                      255
Cur LV                      8
Open LV                     8
Max PV                      16
Cur PV                      1
Act PV                      1
Max PE per PV               3085
VGDA                        2
PE Size (Mbytes)            8
Total PE                    3075
Alloc PE                    2866
Free PE                     209
Total PVG                   0
Total Spare PVs             0
Total Spare PVs in use      0

root@vmnode2:/#</code></pre></div>

<p>With the LVM configuration fixed the next step is to indicate the booting disk to the system.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">root@vmnode2:/# setboot -p /dev/disk/disk21_p2
Primary boot path set to 0/0/0/0.0x0.0x0 (/dev/disk/disk21_p2)
root@vmnode2:/#
root@vmnode2:/# setboot
Primary bootpath : 0/0/0/0.0x0.0x0 (/dev/rdisk/disk21)
HA Alternate bootpath :
Alternate bootpath :

Autoboot is ON (enabled)
root@vmnode2:/#</code></pre></div>

<p>Finally reboot the virtual machine and if we did everything correctly a new boot option will be available in <strong>EFI Boot Manager</strong>.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">EFI Boot Manager ver 1.10 [14.62] [Build: Mon Oct  1 09:27:26 2007]

Please select a boot option

    HP-UX Primary Boot: 0/0/0/0.0x0.0x0                             
    EFI Shell [Built-in]                                            
    Boot option maintenance menu                                    

    Use ^ and v to change option(s). Use Enter to select an option</code></pre></div>

<p>Let the system boot by itself through the new default option <code>HP-UX Primary Boot</code> and we are done.</p>

<p>Any feedback would be welcome.</p>

<p>Juanma.</p>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=/hp-ux/itanium/sysadmin/virtualization/hpvm-clones-first-boot-tasks/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/hp-ux/itanium/sysadmin/virtualization/hpvm-clones-first-boot-tasks/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/hp-ux/itanium/sysadmin/virtualization/hpvm-clones-first-boot-tasks/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>HPVM clones first boot tasks</strong> was published on <time datetime="2010-03-17T12:47:40+01:00">March 17, 2010</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/personal/merry-christmas/" title="Merry Christmas!">Merry Christmas!</a></li>
    
      <li><a href="/hp/networking/virtualization/hp-virtual-connect-domain-setup-part-2-network-setup/" title="HP Virtual Connect Domain Setup - Part 2: Network Setup">HP Virtual Connect Domain Setup - Part 2: Network Setup</a></li>
    
      <li><a href="/hp/networking/virtualization/hp-virtual-connect-domain-setup-part-1-domain-setup-wizard/" title="HP Virtual Connect Domain Setup - Part 1: Domain Setup Wizard">HP Virtual Connect Domain Setup - Part 1: Domain Setup Wizard</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    

<span>&copy; 2015 Juan Manuel Rey. <br> Hosted on <a href="https://pages.github.com" rel="nofollow" target="_blank">GitHub Pages</a> and powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>




</body>
</html>
