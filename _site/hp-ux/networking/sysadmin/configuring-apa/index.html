<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Configuring APA &#8211; Juanma's Blog</title>
<meta name="description" content="Long time since my last post, Christmas you know ;-) BTW Merry Christmas and Happy New Year to all of you.

">
<meta name="keywords" content="11iv3, APA, HP-UX, nwmgr, SMH, sysadmin, systems administration">

  

<!-- Twitter Cards -->
<meta name="twitter:title" content="Configuring APA">
<meta name="twitter:description" content="Long time since my last post, Christmas you know ;-) BTW Merry Christmas and Happy New Year to all of you.

">
<meta name="twitter:site" content="@jreypo">
<meta name="twitter:creator" content="@jreypo">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Configuring APA">
<meta property="og:description" content="Long time since my last post, Christmas you know ;-) BTW Merry Christmas and Happy New Year to all of you.

">
<meta property="og:url" content="/hp-ux/networking/sysadmin/configuring-apa/">
<meta property="og:site_name" content="Juanma's Blog">

<meta property="og:image" content="/images/default-thumb.png">






<link rel="canonical" href="/hp-ux/networking/sysadmin/configuring-apa/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Juanma's Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/">Juanma's Blog</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="/about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="/posts/" >Posts</a></li>
				
				    
				        
				    
				    <li><a href="/vmware-hp-links/" >HP Resources for VMware</a></li>
				
				    
				        
				    
				    <li><a href="/tags/" >Tags</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    
  

<div itemscope itemtype="http://schema.org/Person">


	<img src="/images/bio-photo-2.jpg" class="bio-photo" alt="Juan Manuel Rey bio photo">


  <h3 itemprop="name">Juan Manuel Rey</h3>
  <p>Unix Geek. Sysadmin by heart turned cloud architect for VMware.</p>
  <a href="mailto:Juan Manuel Rey" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
  <a href="http://twitter.com/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  <a href="http://plus.google.com/+JuanManuelReyPortal" class="author-social" target="_blank"><i class="fa fa-fw fa-google-plus-square"></i> Google+</a>
  <a href="http://linkedin.com/in/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  
  
  <a href="http://github.com/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  <a href="http://stackoverflow.com/users/2454288/jreypo" class="author-social" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> Stackoverflow</a>
  
  
  
  
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="/hp-ux/networking/sysadmin/configuring-apa/" rel="bookmark" title="Configuring APA">Configuring APA</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>Long time since my last post, Christmas you know ;-) BTW Merry Christmas and Happy New Year to all of you.</p>

<p>During this weeks I’ve been configuring APA failover groups in some of  my blades and I thought It would be interesting to post how I did it. There are two ways to configure APA in HP-UX 11.31, through the SMH and with the <code>nwmgr</code> command. The screenshots are in Spanish since this is how the SMH of my servers are configured.</p>

<h3 id="smh">SMH</h3>

<p>Log into the server SMH and go to <strong>Tools</strong> -&gt; <strong>Network Interface Configuration</strong> -&gt; <strong>Auto Port Aggregation</strong>.</p>

<p><a href="/images/smh_network_tools_apa.jpg"><img src="/images/smh_network_tools_apa.jpg" alt="SMH Network Tools" title="SMH APA" /></a></p>

<p>Now click on <strong>Create Failover Group</strong> and select the interfaces to add, you can also configure the advanced parameters for the group, when you’re done click OK to finish the operation.</p>

<p><a href="/images/apa_failover_advanced.jpg"><img src="/images/apa_failover_advanced.jpg" alt="APA Failover configuration" title="APA Failover configuration" /></a></p>

<p>Now  in the main page of APA the new group will be shown instead of the LAN interfaces the are part of the group:</p>

<p><a href="/images/apa_finished.jpg"><img src="/images/apa_finished.jpg" alt="APA Main Page" title="APA Main page" /></a></p>

<p>And this is it, the new APA Failover Group is configured and completely transparent to the users. From this point you can show the information about the newly created APA interface.</p>

<p><a href="/images/apa_showing_interface1.jpg"><img src="/images/apa_showing_interface1.jpg" alt="APA Interface Configuration" title="APA Interface Configuration" /></a></p>

<p><a href="/images/apa_showing_config1.jpg"><img src="/images/apa_showing_config1.jpg" alt="APA Configuration" title="APA Configuration" /></a></p>

<h3 id="nwmgr-command">nwmgr command</h3>

<p>The <code>nwmgr</code> command has replaced the old <code>lanscan</code>, <code>lanadmin</code> and <code>linkloop</code> commands in 11.31. I have to say that I prefer this way instead of the SMH one to do any APA or LAN related tasks. SMH require <code>TCP/2301</code> and <code>TCP/2381</code> ports to be open and accessible and this is not always possible mainly because security policies but to use <code>nwmgr</code> you only need access to the server through SSH.</p>

<p>To begin show the current configuration:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">[root@ignite] ~ # nwmgr -g

Name/          Interface Station          Sub-   Interface      Related
ClassInstance  State     Address        system   Type           Interface
============== ========= ============== ======== ============== =========
lan2           DOWN      0x001E0B45E09A igelan   1000Base-SX
lan0           UP        0x001E0B45E09C igelan   1000Base-SX    lan900
lan1           UP        0x001E0B45E09D igelan   1000Base-SX    lan900
lan3           DOWN      0x001E0B45E09B igelan   1000Base-SX
lan900         UP        0x001E0B45E09C hp_apa   hp_apa
lan901         DOWN      0x000000000000 hp_apa   hp_apa
lan902         DOWN      0x000000000000 hp_apa   hp_apa
lan903         DOWN      0x000000000000 hp_apa   hp_apa
lan904         DOWN      0x000000000000 hp_apa   hp_apa
[root@ignite] ~ # nwmgr -g -S apa
Class    Mode        Load      Speed-               Membership
Instance             Balancing Duplex
======== =========== ========= ==================== ===========================
lan900   Not_Enabled LB_MAC    0 Mbps                -
lan901   Not_Enabled LB_MAC    0 Mbps                -
lan902   Not_Enabled LB_MAC    0 Mbps                -
lan903   Not_Enabled LB_MAC    0 Mbps                -
lan904   Not_Enabled LB_MAC    0 Mbps                -
[root@ignite] ~ #</code></pre></div>

<p>Now proceed with the creation of the new failover group:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">[root@ignite] ~ # nwmgr -a -S apa -c lan900 -A links=0,1 -A mode=LAN_MONITOR
Addition of links 0, 1 to lan900 succeeded.
[root@ignite] ~ # nwmgr -s -S apa -A all --saved --from cu
[root@ignite] ~ #</code></pre></div>

<p>Specific advanced parameters can also be set, in the example I used the parameters <code>rapid_arp_count</code> and <code>poll_interval</code>:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">[root@ignite] / # nwmgr -a -S apa -c lan901 -A links=2,1,3 -A mode=LAN_MONITOR -A rapid_arp_count=5 -A poll_interval=0,500000
Addition of links 0, 1 to lan900 succeeded.
[root@ignite] / # nwmgr -s -S apa -A all --saved --from cu
[root@ignite] / #</code></pre></div>

<p>To show the new config:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">[root@ignite] ~ # nwmgr -g

Name/          Interface Station          Sub-   Interface      Related
ClassInstance  State     Address        system   Type           Interface
============== ========= ============== ======== ============== =========
lan2           DOWN      0x001E0B45E09A igelan   1000Base-SX
lan0           UP        0x001E0B45E09C igelan   1000Base-SX    lan900
lan1           UP        0x001E0B45E09D igelan   1000Base-SX    lan900
lan3           DOWN      0x001E0B45E09B igelan   1000Base-SX
lan900         UP        0x001E0B45E09C hp_apa   hp_apa
lan901         DOWN      0x000000000000 hp_apa   hp_apa
lan902         DOWN      0x000000000000 hp_apa   hp_apa
lan903         DOWN      0x000000000000 hp_apa   hp_apa
lan904         DOWN      0x000000000000 hp_apa   hp_apa
[root@ignite] ~ # netstat -ni
Name      Mtu  Network         Address         Ipkts              Ierrs Opkts              Oerrs Coll
lo0      32808 127.0.0.0       127.0.0.1       10100925           0     10100956           0     0
lan900    1500 10.31.4.0       10.31.4.37      256                0     92                 0     0
[root@ignite] ~ #
[root@ignite] ~ # nwmgr -g -S apa
Class    Mode        Load      Speed-               Membership
Instance             Balancing Duplex
======== =========== ========= ==================== ===========================
lan900   LAN_MONITOR LB_HS     1 Gbps Full Duplex   0,1
lan901   Not_Enabled LB_MAC    0 Mbps                -
lan902   Not_Enabled LB_MAC    0 Mbps                -
lan903   Not_Enabled LB_MAC    0 Mbps                -
lan904   Not_Enabled LB_MAC    0 Mbps                -
[root@ignite] ~ #
[root@ignite] ~ # nwmgr -S apa -I 900
Class    Parent APA         Mode        Load      Membership
Instance PPA    State                   Balancing
======== ====== =========== =========== ========= =============================
lan900    -     Up          LAN_MONITOR LB_HS     0,1
[root@ignite] ~ #
[root@ignite] ~ # nwmgr -g -S apa -I 900 -v
lan900 current values:
 Speed = 1 Gbps Full Duplex
 MTU = 1500
 Virtual Maximum Transmission Unit = 0
 MAC Address = 0x001e0b45e09c
 Network Management ID = 6
 Features = Linkagg Interface
 IPV4 Recv CKO
 IPV4 Send CKO
 VLAN Support
 VLAN Tag Offload
 64Bit MIB Support
 Load Distribution Algorithm = LB_HS
 Mode = LAN_MONITOR
 Parent PPA =  -
 APA State = Up
 Membership = 0,1
 Active Port(s) = 0
 Ready Port(s) = 1
 Not Ready Port(s) =  -
 Connected Port(s) = 1
 Polling Interval = 10000000
 Dead Count = 3
 Rapid ARP = on
 Rapid ARP Interval = 1.0 second(s)
 Rapid ARP Count = 10
 Failover Policy = PRIORITY_BASED
[root@ignite] ~ # ifconfig lan900
lan900: flags=1843&lt;UP,BROADCAST,RUNNING,MULTICAST,CKO&gt;
 inet 10.31.4.37 netmask ffffff00 broadcast 10.31.4.255
[root@ignite] ~ #</code></pre></div>

<p>If you want to delete an existent failover group:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">[root@ignite] ~ # nwmgr -d -S apa -A links=all -c lan900 --force
Deletion of links all ports from lan900 succeeded.
[root@ignite] ~ # nwmgr -s -S apa -A all --saved --from cu
[root@ignite] ~ #</code></pre></div>

<p>Or if you just want to remove a interface from the group:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">[root@ignite] ~ # nwmgr -d -S apa -c lan901 -A links=1</code></pre></div>

<p>And we are finished, I still have 11.23 systems and I want APA for them too so I will post how to do it with the <code>lanadmin</code> command.</p>

<p>See you next time.</p>

<p>Juanma.</p>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=/hp-ux/networking/sysadmin/configuring-apa/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/hp-ux/networking/sysadmin/configuring-apa/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/hp-ux/networking/sysadmin/configuring-apa/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>Configuring APA</strong> was published on <time datetime="2010-01-11T17:08:47+01:00">January 11, 2010</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/storage/sysadmin/virtualization/vmware/add-iscsi-volumes-from-hp-p4000-vsa-to-vmware-esxi4/" title="Add iSCSI volumes from HP P4000 VSA to VMware ESXi4">Add iSCSI volumes from HP P4000 VSA to VMware ESXi4</a></li>
    
      <li><a href="/storage/virtualization/first-hands-on-with-the-hp-lefthand-p4000-vsa/" title="First hands-on with the HP Lefthand P4000 VSA">First hands-on with the HP Lefthand P4000 VSA</a></li>
    
      <li><a href="/hp-ux/new-hp-ux-release-new-hpvm-new-features-same-odd-naming-convention/" title="New HP-UX release, new HPVM, new features... same odd naming convention">New HP-UX release, new HPVM, new features... same odd naming convention</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    

<span>&copy; 2015 Juan Manuel Rey. <br> Hosted on <a href="https://pages.github.com" rel="nofollow" target="_blank">GitHub Pages</a> and powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>




</body>
</html>
